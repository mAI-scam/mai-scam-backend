2025-08-17 00:05:43,313 - Application Initialization - INFO - MAI Scam Detection API starting up...
2025-08-17 00:05:43,313 - Application Initialization - INFO - Application state initialized
2025-08-17 00:05:43,314 - Application Initialization - ERROR - Error during application startup: Cannot add middleware after an application has started
2025-08-17 00:07:44,384 - Application Initialization - INFO - MAI Scam Detection API starting up...
2025-08-17 00:07:44,384 - Application Initialization - INFO - Application state initialized
2025-08-17 00:07:44,384 - Application Initialization - INFO - Authentication middleware enabled
2025-08-17 00:07:44,385 - Application Initialization - INFO - Rate limiting enabled
2025-08-17 00:07:44,385 - Application Initialization - INFO - CORS configured
2025-08-17 00:07:44,386 - Application Initialization - INFO - Security headers enabled
2025-08-17 00:07:44,386 - Application Initialization - INFO - Environment: dev
2025-08-17 00:07:44,386 - Application Initialization - INFO - API Version: 0.0.1
2025-08-17 00:07:44,387 - Application Initialization - INFO - MAI Scam Detection API startup completed successfully
2025-08-17 00:12:03,165 - middleware.auth_middleware - INFO - Request: GET /auth/token - 2025-08-17 00:12:03.165401
2025-08-17 00:12:03,174 - middleware.auth_middleware - ERROR - Unhandled error: 'dict' object is not callable
2025-08-17 00:12:03,174 - middleware.auth_middleware - INFO - Response: 500 - 0.009s
2025-08-17 00:12:09,529 - middleware.auth_middleware - INFO - Request: POST /auth/token - 2025-08-17 00:12:09.529256
2025-08-17 00:12:09,530 - middleware.auth_middleware - ERROR - Unhandled error: 'dict' object is not callable
2025-08-17 00:12:09,530 - middleware.auth_middleware - INFO - Response: 500 - 0.001s
2025-08-17 00:12:34,905 - middleware.auth_middleware - INFO - Request: POST /auth/token - 2025-08-17 00:12:34.905363
2025-08-17 00:12:34,906 - middleware.auth_middleware - ERROR - Unhandled error: 'dict' object is not callable
2025-08-17 00:12:34,907 - middleware.auth_middleware - INFO - Response: 500 - 0.002s
2025-08-17 00:12:36,094 - middleware.auth_middleware - INFO - Request: POST /auth/token - 2025-08-17 00:12:36.094640
2025-08-17 00:12:36,095 - middleware.auth_middleware - ERROR - Unhandled error: 'dict' object is not callable
2025-08-17 00:12:36,096 - middleware.auth_middleware - INFO - Response: 500 - 0.002s
2025-08-17 00:15:54,753 - Application Initialization - INFO - MAI Scam Detection API shutting down...
2025-08-17 00:15:54,754 - Application Initialization - INFO - Cleanup operations completed
2025-08-17 00:15:54,754 - Application Initialization - INFO - MAI Scam Detection API shutdown completed
2025-08-17 00:15:59,012 - Application Initialization - INFO - MAI Scam Detection API starting up...
2025-08-17 00:15:59,012 - Application Initialization - INFO - Application state initialized
2025-08-17 00:15:59,013 - Application Initialization - INFO - Authentication middleware enabled
2025-08-17 00:15:59,013 - Application Initialization - INFO - Rate limiting enabled
2025-08-17 00:15:59,013 - Application Initialization - INFO - CORS configured
2025-08-17 00:15:59,014 - Application Initialization - INFO - Security headers enabled
2025-08-17 00:15:59,014 - Application Initialization - INFO - Environment: dev
2025-08-17 00:15:59,014 - Application Initialization - INFO - API Version: 0.0.1
2025-08-17 00:15:59,015 - Application Initialization - INFO - MAI Scam Detection API startup completed successfully
2025-08-17 00:16:03,414 - middleware.auth_middleware - INFO - Request: POST /api/v1/auth/api-key - 2025-08-17 00:16:03.414239
2025-08-17 00:16:03,428 - middleware.auth_middleware - ERROR - Unhandled error: 'dict' object is not callable
2025-08-17 00:16:03,428 - middleware.auth_middleware - INFO - Response: 500 - 0.015s
2025-08-17 00:17:42,137 - Application Initialization - INFO - MAI Scam Detection API shutting down...
2025-08-17 00:17:42,138 - Application Initialization - INFO - Cleanup operations completed
2025-08-17 00:17:42,138 - Application Initialization - INFO - MAI Scam Detection API shutdown completed
2025-08-17 00:17:45,880 - Application Initialization - INFO - MAI Scam Detection API starting up...
2025-08-17 00:17:45,880 - Application Initialization - INFO - Application state initialized
2025-08-17 00:17:45,880 - Application Initialization - INFO - Authentication middleware enabled
2025-08-17 00:17:45,880 - Application Initialization - INFO - Rate limiting enabled
2025-08-17 00:17:45,881 - Application Initialization - INFO - CORS configured
2025-08-17 00:17:45,881 - Application Initialization - INFO - Security headers enabled
2025-08-17 00:17:45,881 - Application Initialization - INFO - Environment: dev
2025-08-17 00:17:45,881 - Application Initialization - INFO - API Version: 0.0.1
2025-08-17 00:17:45,882 - Application Initialization - INFO - MAI Scam Detection API startup completed successfully
2025-08-17 00:17:59,723 - middleware.auth_middleware - INFO - Request: POST /api/v1/auth/api-key - 2025-08-17 00:17:59.723879
2025-08-17 00:17:59,734 - middleware.auth_middleware - ERROR - Unhandled error: 'dict' object is not callable
2025-08-17 00:17:59,735 - middleware.auth_middleware - INFO - Response: 500 - 0.011s
2025-08-17 00:34:31,903 - Application Initialization - INFO - MAI Scam Detection API shutting down...
2025-08-17 00:34:31,904 - Application Initialization - INFO - Cleanup operations completed
2025-08-17 00:34:31,904 - Application Initialization - INFO - MAI Scam Detection API shutdown completed
2025-08-17 00:34:37,671 - Application Initialization - INFO - MAI Scam Detection API starting up...
2025-08-17 00:34:37,671 - Application Initialization - INFO - Application state initialized
2025-08-17 00:34:37,672 - Application Initialization - INFO - Authentication middleware enabled
2025-08-17 00:34:37,672 - Application Initialization - INFO - Rate limiting enabled
2025-08-17 00:34:37,672 - Application Initialization - INFO - CORS configured
2025-08-17 00:34:37,673 - Application Initialization - INFO - Security headers enabled
2025-08-17 00:34:37,673 - Application Initialization - INFO - Environment: dev
2025-08-17 00:34:37,673 - Application Initialization - INFO - API Version: 0.0.1
2025-08-17 00:34:37,673 - Application Initialization - INFO - MAI Scam Detection API startup completed successfully
2025-08-17 00:34:43,126 - middleware.auth_middleware - INFO - Request: POST /api/v1/auth/api-key - 2025-08-17 00:34:43.126396
2025-08-17 00:34:43,136 - middleware.auth_middleware - ERROR - Unhandled error: 'dict' object is not callable
2025-08-17 00:34:43,136 - middleware.auth_middleware - INFO - Response: 500 - 0.010s
2025-08-17 00:37:28,862 - Application Initialization - INFO - MAI Scam Detection API shutting down...
2025-08-17 00:37:28,863 - Application Initialization - INFO - Cleanup operations completed
2025-08-17 00:37:28,863 - Application Initialization - INFO - MAI Scam Detection API shutdown completed
2025-08-17 00:37:33,300 - Application Initialization - INFO - MAI Scam Detection API starting up...
2025-08-17 00:37:33,300 - Application Initialization - INFO - Application state initialized
2025-08-17 00:37:33,300 - Application Initialization - INFO - Authentication middleware enabled
2025-08-17 00:37:33,300 - Application Initialization - INFO - Rate limiting enabled
2025-08-17 00:37:33,301 - Application Initialization - INFO - CORS configured
2025-08-17 00:37:33,301 - Application Initialization - INFO - Security headers enabled
2025-08-17 00:37:33,301 - Application Initialization - INFO - Environment: dev
2025-08-17 00:37:33,301 - Application Initialization - INFO - API Version: 0.0.1
2025-08-17 00:37:33,302 - Application Initialization - INFO - MAI Scam Detection API startup completed successfully
2025-08-17 00:37:35,935 - middleware.auth_middleware - INFO - Request: POST /api/v1/auth/api-key - 2025-08-17 00:37:35.935812
2025-08-17 00:37:35,951 - middleware.auth_middleware - ERROR - Unhandled error in POST /api/v1/auth/api-key: 'dict' object is not callable
2025-08-17 00:37:35,952 - middleware.auth_middleware - ERROR - Error type: TypeError
2025-08-17 00:37:35,952 - middleware.auth_middleware - ERROR - Traceback: Traceback (most recent call last):
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\fastapi\routing.py", line 346, in app
    raise validation_error
fastapi.exceptions.RequestValidationError: [{'type': 'missing', 'loc': ('body', 'client_id'), 'msg': 'Field required', 'input': {'client_type': 'web_extension', 'description': 'My Web Extension API Key'}}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 365, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 304, in __call__
    await self.app(scope, receive, send_with_headers)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 63, in wrapped_app
    await response(scope, receive, sender)
          ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: 'dict' object is not callable

2025-08-17 00:37:35,952 - middleware.auth_middleware - INFO - Response: 500 - 0.017s
2025-08-17 00:40:03,206 - Application Initialization - INFO - MAI Scam Detection API shutting down...
2025-08-17 00:40:03,206 - Application Initialization - INFO - Cleanup operations completed
2025-08-17 00:40:03,206 - Application Initialization - INFO - MAI Scam Detection API shutdown completed
2025-08-17 00:40:07,769 - Application Initialization - INFO - MAI Scam Detection API starting up...
2025-08-17 00:40:07,769 - Application Initialization - INFO - Application state initialized
2025-08-17 00:40:07,770 - Application Initialization - INFO - Authentication middleware enabled
2025-08-17 00:40:07,770 - Application Initialization - INFO - Rate limiting enabled
2025-08-17 00:40:07,770 - Application Initialization - INFO - CORS configured
2025-08-17 00:40:07,771 - Application Initialization - INFO - Security headers enabled
2025-08-17 00:40:07,771 - Application Initialization - INFO - Environment: dev
2025-08-17 00:40:07,771 - Application Initialization - INFO - API Version: 0.0.1
2025-08-17 00:40:07,771 - Application Initialization - INFO - MAI Scam Detection API startup completed successfully
2025-08-17 00:40:08,125 - middleware.auth_middleware - INFO - Request: POST /api/v1/auth/api-key - 2025-08-17 00:40:08.125563
2025-08-17 00:40:08,139 - middleware.auth_middleware - ERROR - Unhandled error in POST /api/v1/auth/api-key: 'dict' object is not callable
2025-08-17 00:40:08,140 - middleware.auth_middleware - ERROR - Error type: TypeError
2025-08-17 00:40:08,140 - middleware.auth_middleware - ERROR - Traceback: Traceback (most recent call last):
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\fastapi\routing.py", line 346, in app
    raise validation_error
fastapi.exceptions.RequestValidationError: [{'type': 'missing', 'loc': ('body', 'client_id'), 'msg': 'Field required', 'input': {'client_type': 'web_extension', 'description': 'My Web Extension API Key'}}]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 365, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 304, in __call__
    await self.app(scope, receive, send_with_headers)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 63, in wrapped_app
    await response(scope, receive, sender)
          ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: 'dict' object is not callable

2025-08-17 00:40:08,140 - middleware.auth_middleware - INFO - Response: 500 - 0.015s
2025-08-17 00:40:39,901 - middleware.auth_middleware - INFO - Request: POST /api/v1/auth/api-key - 2025-08-17 00:40:39.901800
2025-08-17 00:40:39,906 - middleware.auth_middleware - ERROR - Unhandled error in POST /api/v1/auth/api-key: 6 validation errors:
  {'type': 'missing', 'loc': ('response', 'api_key'), 'msg': 'Field required', 'input': {'success': True, 'message': 'API key created successfully', 'data': {'api_key': 'mai_463fe85a60a79c74b8fce6748b5eb73f63786008b2ee6f75d20d46e3946cffda', 'client_id': 'test_client', 'client_type': 'web_extension', 'permissions': ['email_analysis', 'website_analysis', 'social_media_analysis'], 'description': 'My Web Extension API Key', 'created_at': '2025-08-16T16:40:39.902771', 'warning': 'Store this API key securely. It will not be shown again.'}, 'timestamp': '2025-08-16T16:40:39.902790', 'status_code': 201}}
  {'type': 'missing', 'loc': ('response', 'client_id'), 'msg': 'Field required', 'input': {'success': True, 'message': 'API key created successfully', 'data': {'api_key': 'mai_463fe85a60a79c74b8fce6748b5eb73f63786008b2ee6f75d20d46e3946cffda', 'client_id': 'test_client', 'client_type': 'web_extension', 'permissions': ['email_analysis', 'website_analysis', 'social_media_analysis'], 'description': 'My Web Extension API Key', 'created_at': '2025-08-16T16:40:39.902771', 'warning': 'Store this API key securely. It will not be shown again.'}, 'timestamp': '2025-08-16T16:40:39.902790', 'status_code': 201}}
  {'type': 'missing', 'loc': ('response', 'client_type'), 'msg': 'Field required', 'input': {'success': True, 'message': 'API key created successfully', 'data': {'api_key': 'mai_463fe85a60a79c74b8fce6748b5eb73f63786008b2ee6f75d20d46e3946cffda', 'client_id': 'test_client', 'client_type': 'web_extension', 'permissions': ['email_analysis', 'website_analysis', 'social_media_analysis'], 'description': 'My Web Extension API Key', 'created_at': '2025-08-16T16:40:39.902771', 'warning': 'Store this API key securely. It will not be shown again.'}, 'timestamp': '2025-08-16T16:40:39.902790', 'status_code': 201}}
  {'type': 'missing', 'loc': ('response', 'permissions'), 'msg': 'Field required', 'input': {'success': True, 'message': 'API key created successfully', 'data': {'api_key': 'mai_463fe85a60a79c74b8fce6748b5eb73f63786008b2ee6f75d20d46e3946cffda', 'client_id': 'test_client', 'client_type': 'web_extension', 'permissions': ['email_analysis', 'website_analysis', 'social_media_analysis'], 'description': 'My Web Extension API Key', 'created_at': '2025-08-16T16:40:39.902771', 'warning': 'Store this API key securely. It will not be shown again.'}, 'timestamp': '2025-08-16T16:40:39.902790', 'status_code': 201}}
  {'type': 'missing', 'loc': ('response', 'description'), 'msg': 'Field required', 'input': {'success': True, 'message': 'API key created successfully', 'data': {'api_key': 'mai_463fe85a60a79c74b8fce6748b5eb73f63786008b2ee6f75d20d46e3946cffda', 'client_id': 'test_client', 'client_type': 'web_extension', 'permissions': ['email_analysis', 'website_analysis', 'social_media_analysis'], 'description': 'My Web Extension API Key', 'created_at': '2025-08-16T16:40:39.902771', 'warning': 'Store this API key securely. It will not be shown again.'}, 'timestamp': '2025-08-16T16:40:39.902790', 'status_code': 201}}
  {'type': 'missing', 'loc': ('response', 'created_at'), 'msg': 'Field required', 'input': {'success': True, 'message': 'API key created successfully', 'data': {'api_key': 'mai_463fe85a60a79c74b8fce6748b5eb73f63786008b2ee6f75d20d46e3946cffda', 'client_id': 'test_client', 'client_type': 'web_extension', 'permissions': ['email_analysis', 'website_analysis', 'social_media_analysis'], 'description': 'My Web Extension API Key', 'created_at': '2025-08-16T16:40:39.902771', 'warning': 'Store this API key securely. It will not be shown again.'}, 'timestamp': '2025-08-16T16:40:39.902790', 'status_code': 201}}

2025-08-17 00:40:39,907 - middleware.auth_middleware - ERROR - Error type: ResponseValidationError
2025-08-17 00:40:39,907 - middleware.auth_middleware - ERROR - Traceback: Traceback (most recent call last):
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 365, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 304, in __call__
    await self.app(scope, receive, send_with_headers)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\fastapi\routing.py", line 327, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\fastapi\routing.py", line 176, in serialize_response
    raise ResponseValidationError(
        errors=_normalize_errors(errors), body=response_content
    )
fastapi.exceptions.ResponseValidationError: 6 validation errors:
  {'type': 'missing', 'loc': ('response', 'api_key'), 'msg': 'Field required', 'input': {'success': True, 'message': 'API key created successfully', 'data': {'api_key': 'mai_463fe85a60a79c74b8fce6748b5eb73f63786008b2ee6f75d20d46e3946cffda', 'client_id': 'test_client', 'client_type': 'web_extension', 'permissions': ['email_analysis', 'website_analysis', 'social_media_analysis'], 'description': 'My Web Extension API Key', 'created_at': '2025-08-16T16:40:39.902771', 'warning': 'Store this API key securely. It will not be shown again.'}, 'timestamp': '2025-08-16T16:40:39.902790', 'status_code': 201}}
  {'type': 'missing', 'loc': ('response', 'client_id'), 'msg': 'Field required', 'input': {'success': True, 'message': 'API key created successfully', 'data': {'api_key': 'mai_463fe85a60a79c74b8fce6748b5eb73f63786008b2ee6f75d20d46e3946cffda', 'client_id': 'test_client', 'client_type': 'web_extension', 'permissions': ['email_analysis', 'website_analysis', 'social_media_analysis'], 'description': 'My Web Extension API Key', 'created_at': '2025-08-16T16:40:39.902771', 'warning': 'Store this API key securely. It will not be shown again.'}, 'timestamp': '2025-08-16T16:40:39.902790', 'status_code': 201}}
  {'type': 'missing', 'loc': ('response', 'client_type'), 'msg': 'Field required', 'input': {'success': True, 'message': 'API key created successfully', 'data': {'api_key': 'mai_463fe85a60a79c74b8fce6748b5eb73f63786008b2ee6f75d20d46e3946cffda', 'client_id': 'test_client', 'client_type': 'web_extension', 'permissions': ['email_analysis', 'website_analysis', 'social_media_analysis'], 'description': 'My Web Extension API Key', 'created_at': '2025-08-16T16:40:39.902771', 'warning': 'Store this API key securely. It will not be shown again.'}, 'timestamp': '2025-08-16T16:40:39.902790', 'status_code': 201}}
  {'type': 'missing', 'loc': ('response', 'permissions'), 'msg': 'Field required', 'input': {'success': True, 'message': 'API key created successfully', 'data': {'api_key': 'mai_463fe85a60a79c74b8fce6748b5eb73f63786008b2ee6f75d20d46e3946cffda', 'client_id': 'test_client', 'client_type': 'web_extension', 'permissions': ['email_analysis', 'website_analysis', 'social_media_analysis'], 'description': 'My Web Extension API Key', 'created_at': '2025-08-16T16:40:39.902771', 'warning': 'Store this API key securely. It will not be shown again.'}, 'timestamp': '2025-08-16T16:40:39.902790', 'status_code': 201}}
  {'type': 'missing', 'loc': ('response', 'description'), 'msg': 'Field required', 'input': {'success': True, 'message': 'API key created successfully', 'data': {'api_key': 'mai_463fe85a60a79c74b8fce6748b5eb73f63786008b2ee6f75d20d46e3946cffda', 'client_id': 'test_client', 'client_type': 'web_extension', 'permissions': ['email_analysis', 'website_analysis', 'social_media_analysis'], 'description': 'My Web Extension API Key', 'created_at': '2025-08-16T16:40:39.902771', 'warning': 'Store this API key securely. It will not be shown again.'}, 'timestamp': '2025-08-16T16:40:39.902790', 'status_code': 201}}
  {'type': 'missing', 'loc': ('response', 'created_at'), 'msg': 'Field required', 'input': {'success': True, 'message': 'API key created successfully', 'data': {'api_key': 'mai_463fe85a60a79c74b8fce6748b5eb73f63786008b2ee6f75d20d46e3946cffda', 'client_id': 'test_client', 'client_type': 'web_extension', 'permissions': ['email_analysis', 'website_analysis', 'social_media_analysis'], 'description': 'My Web Extension API Key', 'created_at': '2025-08-16T16:40:39.902771', 'warning': 'Store this API key securely. It will not be shown again.'}, 'timestamp': '2025-08-16T16:40:39.902790', 'status_code': 201}}


2025-08-17 00:40:39,908 - middleware.auth_middleware - INFO - Response: 500 - 0.006s
2025-08-17 00:40:45,301 - Application Initialization - INFO - MAI Scam Detection API shutting down...
2025-08-17 00:40:45,302 - Application Initialization - INFO - Cleanup operations completed
2025-08-17 00:40:45,302 - Application Initialization - INFO - MAI Scam Detection API shutdown completed
2025-08-17 00:40:49,504 - Application Initialization - INFO - MAI Scam Detection API starting up...
2025-08-17 00:40:49,504 - Application Initialization - INFO - Application state initialized
2025-08-17 00:40:49,504 - Application Initialization - INFO - Authentication middleware enabled
2025-08-17 00:40:49,505 - Application Initialization - INFO - Rate limiting enabled
2025-08-17 00:40:49,505 - Application Initialization - INFO - CORS configured
2025-08-17 00:40:49,505 - Application Initialization - INFO - Security headers enabled
2025-08-17 00:40:49,506 - Application Initialization - INFO - Environment: dev
2025-08-17 00:40:49,506 - Application Initialization - INFO - API Version: 0.0.1
2025-08-17 00:40:49,506 - Application Initialization - INFO - MAI Scam Detection API startup completed successfully
2025-08-17 00:40:51,954 - middleware.auth_middleware - INFO - Request: POST /api/v1/auth/api-key - 2025-08-17 00:40:51.954105
2025-08-17 00:40:51,963 - middleware.auth_middleware - ERROR - Unhandled error in POST /api/v1/auth/api-key: 6 validation errors:
  {'type': 'missing', 'loc': ('response', 'api_key'), 'msg': 'Field required', 'input': {'success': True, 'message': 'API key created successfully', 'data': {'api_key': 'mai_afbfdf24dc4cae6433995e1e6e6a2623fef7a0540c7012e543aacd1e7a1a4709', 'client_id': 'test_client', 'client_type': 'web_extension', 'permissions': ['email_analysis', 'website_analysis', 'social_media_analysis'], 'description': 'My Web Extension API Key', 'created_at': '2025-08-16T16:40:51.957149', 'warning': 'Store this API key securely. It will not be shown again.'}, 'timestamp': '2025-08-16T16:40:51.957169', 'status_code': 201}}
  {'type': 'missing', 'loc': ('response', 'client_id'), 'msg': 'Field required', 'input': {'success': True, 'message': 'API key created successfully', 'data': {'api_key': 'mai_afbfdf24dc4cae6433995e1e6e6a2623fef7a0540c7012e543aacd1e7a1a4709', 'client_id': 'test_client', 'client_type': 'web_extension', 'permissions': ['email_analysis', 'website_analysis', 'social_media_analysis'], 'description': 'My Web Extension API Key', 'created_at': '2025-08-16T16:40:51.957149', 'warning': 'Store this API key securely. It will not be shown again.'}, 'timestamp': '2025-08-16T16:40:51.957169', 'status_code': 201}}
  {'type': 'missing', 'loc': ('response', 'client_type'), 'msg': 'Field required', 'input': {'success': True, 'message': 'API key created successfully', 'data': {'api_key': 'mai_afbfdf24dc4cae6433995e1e6e6a2623fef7a0540c7012e543aacd1e7a1a4709', 'client_id': 'test_client', 'client_type': 'web_extension', 'permissions': ['email_analysis', 'website_analysis', 'social_media_analysis'], 'description': 'My Web Extension API Key', 'created_at': '2025-08-16T16:40:51.957149', 'warning': 'Store this API key securely. It will not be shown again.'}, 'timestamp': '2025-08-16T16:40:51.957169', 'status_code': 201}}
  {'type': 'missing', 'loc': ('response', 'permissions'), 'msg': 'Field required', 'input': {'success': True, 'message': 'API key created successfully', 'data': {'api_key': 'mai_afbfdf24dc4cae6433995e1e6e6a2623fef7a0540c7012e543aacd1e7a1a4709', 'client_id': 'test_client', 'client_type': 'web_extension', 'permissions': ['email_analysis', 'website_analysis', 'social_media_analysis'], 'description': 'My Web Extension API Key', 'created_at': '2025-08-16T16:40:51.957149', 'warning': 'Store this API key securely. It will not be shown again.'}, 'timestamp': '2025-08-16T16:40:51.957169', 'status_code': 201}}
  {'type': 'missing', 'loc': ('response', 'description'), 'msg': 'Field required', 'input': {'success': True, 'message': 'API key created successfully', 'data': {'api_key': 'mai_afbfdf24dc4cae6433995e1e6e6a2623fef7a0540c7012e543aacd1e7a1a4709', 'client_id': 'test_client', 'client_type': 'web_extension', 'permissions': ['email_analysis', 'website_analysis', 'social_media_analysis'], 'description': 'My Web Extension API Key', 'created_at': '2025-08-16T16:40:51.957149', 'warning': 'Store this API key securely. It will not be shown again.'}, 'timestamp': '2025-08-16T16:40:51.957169', 'status_code': 201}}
  {'type': 'missing', 'loc': ('response', 'created_at'), 'msg': 'Field required', 'input': {'success': True, 'message': 'API key created successfully', 'data': {'api_key': 'mai_afbfdf24dc4cae6433995e1e6e6a2623fef7a0540c7012e543aacd1e7a1a4709', 'client_id': 'test_client', 'client_type': 'web_extension', 'permissions': ['email_analysis', 'website_analysis', 'social_media_analysis'], 'description': 'My Web Extension API Key', 'created_at': '2025-08-16T16:40:51.957149', 'warning': 'Store this API key securely. It will not be shown again.'}, 'timestamp': '2025-08-16T16:40:51.957169', 'status_code': 201}}

2025-08-17 00:40:51,964 - middleware.auth_middleware - ERROR - Error type: ResponseValidationError
2025-08-17 00:40:51,965 - middleware.auth_middleware - ERROR - Traceback: Traceback (most recent call last):
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 365, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 304, in __call__
    await self.app(scope, receive, send_with_headers)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\fastapi\routing.py", line 327, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\fastapi\routing.py", line 176, in serialize_response
    raise ResponseValidationError(
        errors=_normalize_errors(errors), body=response_content
    )
fastapi.exceptions.ResponseValidationError: 6 validation errors:
  {'type': 'missing', 'loc': ('response', 'api_key'), 'msg': 'Field required', 'input': {'success': True, 'message': 'API key created successfully', 'data': {'api_key': 'mai_afbfdf24dc4cae6433995e1e6e6a2623fef7a0540c7012e543aacd1e7a1a4709', 'client_id': 'test_client', 'client_type': 'web_extension', 'permissions': ['email_analysis', 'website_analysis', 'social_media_analysis'], 'description': 'My Web Extension API Key', 'created_at': '2025-08-16T16:40:51.957149', 'warning': 'Store this API key securely. It will not be shown again.'}, 'timestamp': '2025-08-16T16:40:51.957169', 'status_code': 201}}
  {'type': 'missing', 'loc': ('response', 'client_id'), 'msg': 'Field required', 'input': {'success': True, 'message': 'API key created successfully', 'data': {'api_key': 'mai_afbfdf24dc4cae6433995e1e6e6a2623fef7a0540c7012e543aacd1e7a1a4709', 'client_id': 'test_client', 'client_type': 'web_extension', 'permissions': ['email_analysis', 'website_analysis', 'social_media_analysis'], 'description': 'My Web Extension API Key', 'created_at': '2025-08-16T16:40:51.957149', 'warning': 'Store this API key securely. It will not be shown again.'}, 'timestamp': '2025-08-16T16:40:51.957169', 'status_code': 201}}
  {'type': 'missing', 'loc': ('response', 'client_type'), 'msg': 'Field required', 'input': {'success': True, 'message': 'API key created successfully', 'data': {'api_key': 'mai_afbfdf24dc4cae6433995e1e6e6a2623fef7a0540c7012e543aacd1e7a1a4709', 'client_id': 'test_client', 'client_type': 'web_extension', 'permissions': ['email_analysis', 'website_analysis', 'social_media_analysis'], 'description': 'My Web Extension API Key', 'created_at': '2025-08-16T16:40:51.957149', 'warning': 'Store this API key securely. It will not be shown again.'}, 'timestamp': '2025-08-16T16:40:51.957169', 'status_code': 201}}
  {'type': 'missing', 'loc': ('response', 'permissions'), 'msg': 'Field required', 'input': {'success': True, 'message': 'API key created successfully', 'data': {'api_key': 'mai_afbfdf24dc4cae6433995e1e6e6a2623fef7a0540c7012e543aacd1e7a1a4709', 'client_id': 'test_client', 'client_type': 'web_extension', 'permissions': ['email_analysis', 'website_analysis', 'social_media_analysis'], 'description': 'My Web Extension API Key', 'created_at': '2025-08-16T16:40:51.957149', 'warning': 'Store this API key securely. It will not be shown again.'}, 'timestamp': '2025-08-16T16:40:51.957169', 'status_code': 201}}
  {'type': 'missing', 'loc': ('response', 'description'), 'msg': 'Field required', 'input': {'success': True, 'message': 'API key created successfully', 'data': {'api_key': 'mai_afbfdf24dc4cae6433995e1e6e6a2623fef7a0540c7012e543aacd1e7a1a4709', 'client_id': 'test_client', 'client_type': 'web_extension', 'permissions': ['email_analysis', 'website_analysis', 'social_media_analysis'], 'description': 'My Web Extension API Key', 'created_at': '2025-08-16T16:40:51.957149', 'warning': 'Store this API key securely. It will not be shown again.'}, 'timestamp': '2025-08-16T16:40:51.957169', 'status_code': 201}}
  {'type': 'missing', 'loc': ('response', 'created_at'), 'msg': 'Field required', 'input': {'success': True, 'message': 'API key created successfully', 'data': {'api_key': 'mai_afbfdf24dc4cae6433995e1e6e6a2623fef7a0540c7012e543aacd1e7a1a4709', 'client_id': 'test_client', 'client_type': 'web_extension', 'permissions': ['email_analysis', 'website_analysis', 'social_media_analysis'], 'description': 'My Web Extension API Key', 'created_at': '2025-08-16T16:40:51.957149', 'warning': 'Store this API key securely. It will not be shown again.'}, 'timestamp': '2025-08-16T16:40:51.957169', 'status_code': 201}}


2025-08-17 00:40:51,965 - middleware.auth_middleware - INFO - Response: 500 - 0.011s
2025-08-17 00:43:14,403 - Application Initialization - INFO - MAI Scam Detection API shutting down...
2025-08-17 00:43:14,403 - Application Initialization - INFO - Cleanup operations completed
2025-08-17 00:43:14,404 - Application Initialization - INFO - MAI Scam Detection API shutdown completed
2025-08-17 00:43:18,400 - Application Initialization - INFO - MAI Scam Detection API starting up...
2025-08-17 00:43:18,401 - Application Initialization - INFO - Application state initialized
2025-08-17 00:43:18,401 - Application Initialization - INFO - Authentication middleware enabled
2025-08-17 00:43:18,401 - Application Initialization - INFO - Rate limiting enabled
2025-08-17 00:43:18,401 - Application Initialization - INFO - CORS configured
2025-08-17 00:43:18,402 - Application Initialization - INFO - Security headers enabled
2025-08-17 00:43:18,402 - Application Initialization - INFO - Environment: dev
2025-08-17 00:43:18,402 - Application Initialization - INFO - API Version: 0.0.1
2025-08-17 00:43:18,402 - Application Initialization - INFO - MAI Scam Detection API startup completed successfully
2025-08-17 00:43:21,348 - middleware.auth_middleware - INFO - Request: POST /api/v1/auth/api-key - 2025-08-17 00:43:21.348063
2025-08-17 00:43:21,350 - middleware.auth_middleware - INFO - Response: 200 - 0.003s
2025-08-17 00:44:25,360 - middleware.auth_middleware - INFO - Request: POST /api/v1/auth/token - 2025-08-17 00:44:25.360110
2025-08-17 00:44:25,363 - middleware.auth_middleware - INFO - Response: 200 - 0.004s
2025-08-17 00:46:14,555 - middleware.auth_middleware - INFO - Request: POST /email/analyze - 2025-08-17 00:46:14.555361
2025-08-17 00:46:14,566 - middleware.auth_middleware - ERROR - Unhandled error in POST /email/analyze: 'dict' object is not callable
2025-08-17 00:46:14,566 - middleware.auth_middleware - ERROR - Error type: TypeError
2025-08-17 00:46:14,567 - middleware.auth_middleware - ERROR - Traceback: Traceback (most recent call last):
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 764, in app
    await self.default(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 650, in not_found
    raise HTTPException(status_code=404)
starlette.exceptions.HTTPException: 404: Not Found

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 365, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 304, in __call__
    await self.app(scope, receive, send_with_headers)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 63, in wrapped_app
    await response(scope, receive, sender)
          ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: 'dict' object is not callable

2025-08-17 00:46:14,567 - middleware.auth_middleware - INFO - Response: 500 - 0.012s
2025-08-17 00:48:03,036 - Application Initialization - INFO - MAI Scam Detection API shutting down...
2025-08-17 00:48:03,037 - Application Initialization - INFO - Cleanup operations completed
2025-08-17 00:48:03,038 - Application Initialization - INFO - MAI Scam Detection API shutdown completed
2025-08-17 00:48:08,127 - Application Initialization - INFO - MAI Scam Detection API starting up...
2025-08-17 00:48:08,127 - Application Initialization - INFO - Application state initialized
2025-08-17 00:48:08,128 - Application Initialization - INFO - Authentication middleware enabled
2025-08-17 00:48:08,128 - Application Initialization - INFO - Rate limiting enabled
2025-08-17 00:48:08,128 - Application Initialization - INFO - CORS configured
2025-08-17 00:48:08,128 - Application Initialization - INFO - Security headers enabled
2025-08-17 00:48:08,129 - Application Initialization - INFO - Environment: dev
2025-08-17 00:48:08,129 - Application Initialization - INFO - API Version: 0.0.1
2025-08-17 00:48:08,129 - Application Initialization - INFO - MAI Scam Detection API startup completed successfully
2025-08-17 00:48:25,803 - middleware.auth_middleware - INFO - Request: POST /email/translate - 2025-08-17 00:48:25.803556
2025-08-17 00:48:25,818 - middleware.auth_middleware - ERROR - Unhandled error in POST /email/translate: 'dict' object is not callable
2025-08-17 00:48:25,819 - middleware.auth_middleware - ERROR - Error type: TypeError
2025-08-17 00:48:25,819 - middleware.auth_middleware - ERROR - Traceback: Traceback (most recent call last):
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 764, in app
    await self.default(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 650, in not_found
    raise HTTPException(status_code=404)
starlette.exceptions.HTTPException: 404: Not Found

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 365, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 304, in __call__
    await self.app(scope, receive, send_with_headers)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 63, in wrapped_app
    await response(scope, receive, sender)
          ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: 'dict' object is not callable

2025-08-17 00:48:25,820 - middleware.auth_middleware - INFO - Response: 500 - 0.017s
2025-08-17 00:48:31,407 - middleware.auth_middleware - INFO - Request: POST /email/analyze - 2025-08-17 00:48:31.407748
2025-08-17 00:48:31,410 - middleware.auth_middleware - ERROR - Unhandled error in POST /email/analyze: 'dict' object is not callable
2025-08-17 00:48:31,411 - middleware.auth_middleware - ERROR - Error type: TypeError
2025-08-17 00:48:31,411 - middleware.auth_middleware - ERROR - Traceback: Traceback (most recent call last):
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 764, in app
    await self.default(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 650, in not_found
    raise HTTPException(status_code=404)
starlette.exceptions.HTTPException: 404: Not Found

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 365, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 304, in __call__
    await self.app(scope, receive, send_with_headers)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 63, in wrapped_app
    await response(scope, receive, sender)
          ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: 'dict' object is not callable

2025-08-17 00:48:31,412 - middleware.auth_middleware - INFO - Response: 500 - 0.004s
2025-08-17 00:49:30,361 - middleware.auth_middleware - INFO - Request: POST /email/analyze - 2025-08-17 00:49:30.361893
2025-08-17 00:49:30,364 - middleware.auth_middleware - ERROR - Unhandled error in POST /email/analyze: 'dict' object is not callable
2025-08-17 00:49:30,365 - middleware.auth_middleware - ERROR - Error type: TypeError
2025-08-17 00:49:30,365 - middleware.auth_middleware - ERROR - Traceback: Traceback (most recent call last):
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 764, in app
    await self.default(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 650, in not_found
    raise HTTPException(status_code=404)
starlette.exceptions.HTTPException: 404: Not Found

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 365, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 304, in __call__
    await self.app(scope, receive, send_with_headers)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 63, in wrapped_app
    await response(scope, receive, sender)
          ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: 'dict' object is not callable

2025-08-17 00:49:30,366 - middleware.auth_middleware - INFO - Response: 500 - 0.005s
2025-08-17 00:49:44,716 - middleware.auth_middleware - INFO - Request: POST /email/analyze - 2025-08-17 00:49:44.716773
2025-08-17 00:49:44,720 - middleware.auth_middleware - ERROR - Unhandled error in POST /email/analyze: 'dict' object is not callable
2025-08-17 00:49:44,720 - middleware.auth_middleware - ERROR - Error type: TypeError
2025-08-17 00:49:44,720 - middleware.auth_middleware - ERROR - Traceback: Traceback (most recent call last):
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 764, in app
    await self.default(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 650, in not_found
    raise HTTPException(status_code=404)
starlette.exceptions.HTTPException: 404: Not Found

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 365, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 304, in __call__
    await self.app(scope, receive, send_with_headers)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 63, in wrapped_app
    await response(scope, receive, sender)
          ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: 'dict' object is not callable

2025-08-17 00:49:44,721 - middleware.auth_middleware - INFO - Response: 500 - 0.004s
2025-08-17 00:50:14,457 - middleware.auth_middleware - INFO - Request: POST /email/analyze - 2025-08-17 00:50:14.457464
2025-08-17 00:50:14,460 - middleware.auth_middleware - ERROR - Unhandled error in POST /email/analyze: 'dict' object is not callable
2025-08-17 00:50:14,460 - middleware.auth_middleware - ERROR - Error type: TypeError
2025-08-17 00:50:14,460 - middleware.auth_middleware - ERROR - Traceback: Traceback (most recent call last):
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 764, in app
    await self.default(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 650, in not_found
    raise HTTPException(status_code=404)
starlette.exceptions.HTTPException: 404: Not Found

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 365, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 304, in __call__
    await self.app(scope, receive, send_with_headers)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 63, in wrapped_app
    await response(scope, receive, sender)
          ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: 'dict' object is not callable

2025-08-17 00:50:14,461 - middleware.auth_middleware - INFO - Response: 500 - 0.004s
2025-08-17 00:50:22,477 - Application Initialization - INFO - MAI Scam Detection API shutting down...
2025-08-17 00:50:22,478 - Application Initialization - INFO - Cleanup operations completed
2025-08-17 00:50:22,478 - Application Initialization - INFO - MAI Scam Detection API shutdown completed
2025-08-17 00:50:26,396 - Application Initialization - INFO - MAI Scam Detection API starting up...
2025-08-17 00:50:26,397 - Application Initialization - INFO - Application state initialized
2025-08-17 00:50:26,397 - Application Initialization - INFO - Authentication middleware enabled
2025-08-17 00:50:26,397 - Application Initialization - INFO - Rate limiting enabled
2025-08-17 00:50:26,398 - Application Initialization - INFO - CORS configured
2025-08-17 00:50:26,398 - Application Initialization - INFO - Security headers enabled
2025-08-17 00:50:26,398 - Application Initialization - INFO - Environment: dev
2025-08-17 00:50:26,398 - Application Initialization - INFO - API Version: 0.0.1
2025-08-17 00:50:26,399 - Application Initialization - INFO - MAI Scam Detection API startup completed successfully
2025-08-17 00:50:28,011 - middleware.auth_middleware - INFO - Request: POST /email/analyze - 2025-08-17 00:50:28.011093
2025-08-17 00:50:28,029 - middleware.auth_middleware - ERROR - Unhandled error in POST /email/analyze: 'dict' object is not callable
2025-08-17 00:50:28,029 - middleware.auth_middleware - ERROR - Error type: TypeError
2025-08-17 00:50:28,029 - middleware.auth_middleware - ERROR - Traceback: Traceback (most recent call last):
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 764, in app
    await self.default(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 650, in not_found
    raise HTTPException(status_code=404)
starlette.exceptions.HTTPException: 404: Not Found

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 365, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 304, in __call__
    await self.app(scope, receive, send_with_headers)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 63, in wrapped_app
    await response(scope, receive, sender)
          ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: 'dict' object is not callable

2025-08-17 00:50:28,030 - middleware.auth_middleware - INFO - Response: 500 - 0.019s
2025-08-17 00:50:32,925 - middleware.auth_middleware - INFO - Request: POST /auth/api-key - 2025-08-17 00:50:32.925385
2025-08-17 00:50:32,928 - middleware.auth_middleware - INFO - Response: 200 - 0.003s
2025-08-17 00:50:38,358 - middleware.auth_middleware - INFO - Request: POST /email/analyze - 2025-08-17 00:50:38.358025
2025-08-17 00:50:38,360 - middleware.auth_middleware - ERROR - Unhandled error in POST /email/analyze: 'dict' object is not callable
2025-08-17 00:50:38,360 - middleware.auth_middleware - ERROR - Error type: TypeError
2025-08-17 00:50:38,361 - middleware.auth_middleware - ERROR - Traceback: Traceback (most recent call last):
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 764, in app
    await self.default(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 650, in not_found
    raise HTTPException(status_code=404)
starlette.exceptions.HTTPException: 404: Not Found

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 365, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 304, in __call__
    await self.app(scope, receive, send_with_headers)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 63, in wrapped_app
    await response(scope, receive, sender)
          ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: 'dict' object is not callable

2025-08-17 00:50:38,361 - middleware.auth_middleware - INFO - Response: 500 - 0.004s
2025-08-17 00:51:32,306 - middleware.auth_middleware - INFO - Request: POST /email/analyze - 2025-08-17 00:51:32.306697
2025-08-17 00:51:32,309 - middleware.auth_middleware - ERROR - Unhandled error in POST /email/analyze: 'dict' object is not callable
2025-08-17 00:51:32,310 - middleware.auth_middleware - ERROR - Error type: TypeError
2025-08-17 00:51:32,310 - middleware.auth_middleware - ERROR - Traceback: Traceback (most recent call last):
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 764, in app
    await self.default(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 650, in not_found
    raise HTTPException(status_code=404)
starlette.exceptions.HTTPException: 404: Not Found

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 365, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 304, in __call__
    await self.app(scope, receive, send_with_headers)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 63, in wrapped_app
    await response(scope, receive, sender)
          ~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: 'dict' object is not callable

2025-08-17 00:51:32,310 - middleware.auth_middleware - INFO - Response: 500 - 0.004s
2025-08-17 00:51:42,203 - Application Initialization - INFO - MAI Scam Detection API shutting down...
2025-08-17 00:51:42,203 - Application Initialization - INFO - Cleanup operations completed
2025-08-17 00:51:42,203 - Application Initialization - INFO - MAI Scam Detection API shutdown completed
2025-08-17 00:51:49,321 - Application Initialization - INFO - MAI Scam Detection API starting up...
2025-08-17 00:51:49,322 - Application Initialization - INFO - Application state initialized
2025-08-17 00:51:49,322 - Application Initialization - INFO - Authentication middleware enabled
2025-08-17 00:51:49,322 - Application Initialization - INFO - Rate limiting enabled
2025-08-17 00:51:49,323 - Application Initialization - INFO - CORS configured
2025-08-17 00:51:49,323 - Application Initialization - INFO - Security headers enabled
2025-08-17 00:51:49,323 - Application Initialization - INFO - Environment: dev
2025-08-17 00:51:49,323 - Application Initialization - INFO - API Version: 0.0.1
2025-08-17 00:51:49,323 - Application Initialization - INFO - MAI Scam Detection API startup completed successfully
2025-08-17 00:51:51,203 - middleware.auth_middleware - INFO - Request: POST /email/analyze - 2025-08-17 00:51:51.203423
2025-08-17 00:51:51,212 - middleware.auth_middleware - INFO - Response: 404 - 0.009s
2025-08-17 00:52:04,326 - middleware.auth_middleware - INFO - Request: POST /email/analyze - 2025-08-17 00:52:04.326215
2025-08-17 00:52:04,327 - middleware.auth_middleware - INFO - Response: 404 - 0.001s
2025-08-17 00:52:09,720 - middleware.auth_middleware - INFO - Request: POST /email/analyze - 2025-08-17 00:52:09.720274
2025-08-17 00:52:09,721 - middleware.auth_middleware - INFO - Response: 404 - 0.002s
2025-08-17 00:52:42,781 - middleware.auth_middleware - INFO - Request: POST /email/analyze - 2025-08-17 00:52:42.781172
2025-08-17 00:52:42,782 - middleware.auth_middleware - INFO - Response: 404 - 0.001s
2025-08-17 00:53:00,339 - Application Initialization - INFO - MAI Scam Detection API shutting down...
2025-08-17 00:53:00,340 - Application Initialization - INFO - Cleanup operations completed
2025-08-17 00:53:00,340 - Application Initialization - INFO - MAI Scam Detection API shutdown completed
2025-08-17 00:53:04,437 - Application Initialization - INFO - MAI Scam Detection API starting up...
2025-08-17 00:53:04,437 - Application Initialization - INFO - Application state initialized
2025-08-17 00:53:04,437 - Application Initialization - INFO - Authentication middleware enabled
2025-08-17 00:53:04,438 - Application Initialization - INFO - Rate limiting enabled
2025-08-17 00:53:04,438 - Application Initialization - INFO - CORS configured
2025-08-17 00:53:04,438 - Application Initialization - INFO - Security headers enabled
2025-08-17 00:53:04,438 - Application Initialization - INFO - Environment: dev
2025-08-17 00:53:04,439 - Application Initialization - INFO - API Version: 0.0.1
2025-08-17 00:53:04,439 - Application Initialization - INFO - MAI Scam Detection API startup completed successfully
2025-08-17 00:53:08,834 - middleware.auth_middleware - INFO - Request: POST /email/analyze - 2025-08-17 00:53:08.834197
2025-08-17 00:53:09,872 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-e8ffc294-3336-4a7b-82d4-24c2386615be', 'json_data': {'messages': [{'role': 'user', 'content': '\n[ROLE]\nYou are a precise language identification module for email data in Southeast Asia.\n\n[GOAL]\nReturn ONLY the dominant BASE language of the EMAIL CONTENT as an ISO-639-1 code in lowercase.\n\n[AVAILABLE LANGUAGES]\n```\nen, zh, ms, th, vi\n```\n\n[RULES]\n- Choose from ALLOWED LANGUAGES only. Do not invent new codes (e.g., no "zh-cn", "sg-en").\n- If content is code-mixed, pick the language covering the majority of meaningful tokens in CONTENT.\n- If near-tie, prefer the language used by the majority of complete sentences in CONTENT.\n- Normalize: treat Chinese/Mandarin as "zh"; Bahasa Melayu -> "ms"; Bahasa Indonesia -> "id".\n- Ignore when deciding: URLs, email addresses, numbers, emojis, boilerplate signatures/disclaimers, quoted previous replies, headers like "Re:"/"Fwd:".\n- Be deterministic.\n\n[OUTPUT FORMAT]\nReturn EXACTLY one single-line minified JSON object (no prose, no markdown, no code fences):\n{\n    "base_language":"<iso>"\n}\n\n[EMAIL CONTENT]\n```\nDear valued customer, your account has been suspended due to suspicious activity. Please click the link below to verify your identity and restore access immediately. Failure to do so within 24 hours will result in permanent account closure. https://bit.ly/verify-account-now\n```\n'}], 'model': 'aisingapore/Llama-SEA-LION-v3.5-70B-R'}, 'extra_json': {'chat_template_kwargs': {'thinking_mode': 'off'}, 'cache': {'no-cache': True}}}
2025-08-17 00:53:09,974 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.sea-lion.ai/v1/chat/completions
2025-08-17 00:53:09,975 - httpcore.connection - DEBUG - connect_tcp.started host='api.sea-lion.ai' port=443 local_address=None timeout=5.0 socket_options=None
2025-08-17 00:53:10,291 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000138504C5160>
2025-08-17 00:53:10,292 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000001384F0331D0> server_hostname='api.sea-lion.ai' timeout=5.0
2025-08-17 00:53:10,801 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x00000138503E5A90>
2025-08-17 00:53:10,801 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-17 00:53:10,802 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-08-17 00:53:10,802 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-17 00:53:10,803 - httpcore.http11 - DEBUG - send_request_body.complete
2025-08-17 00:53:10,803 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-17 00:53:11,430 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Sat, 16 Aug 2025 16:53:11 GMT'), (b'Content-Type', b'application/json'), (b'Content-Length', b'545'), (b'Connection', b'keep-alive'), (b'server', b'uvicorn'), (b'x-litellm-call-id', b'933054ec-bf71-42a6-bf1b-9b7054e90e1b'), (b'x-litellm-model-id', b'320c14227ccff7f17d435b101d7243e1ef040b82cc0be675ede6985d5a651827'), (b'x-litellm-model-api-base', b'http://llama-sea-lion-v3-5-70b-r/v1'), (b'x-litellm-version', b'1.56.3'), (b'x-litellm-response-cost', b'0.0017350000000000002'), (b'x-litellm-key-tpm-limit', b'None'), (b'x-litellm-key-rpm-limit', b'None'), (b'llm_provider-date', b'Sat, 16 Aug 2025 16:53:10 GMT'), (b'llm_provider-server', b'uvicorn'), (b'llm_provider-content-length', b'503'), (b'llm_provider-content-type', b'application/json'), (b'x-litellm-model-group', b'aisingapore/Llama-SEA-LION-v3.5-70B-R')])
2025-08-17 00:53:11,434 - httpx - INFO - HTTP Request: POST https://api.sea-lion.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-17 00:53:11,435 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-17 00:53:11,436 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-08-17 00:53:11,437 - httpcore.http11 - DEBUG - response_closed.started
2025-08-17 00:53:11,438 - httpcore.http11 - DEBUG - response_closed.complete
2025-08-17 00:53:11,439 - openai._base_client - DEBUG - HTTP Response: POST https://api.sea-lion.ai/v1/chat/completions "200 OK" Headers({'date': 'Sat, 16 Aug 2025 16:53:11 GMT', 'content-type': 'application/json', 'content-length': '545', 'connection': 'keep-alive', 'server': 'uvicorn', 'x-litellm-call-id': '933054ec-bf71-42a6-bf1b-9b7054e90e1b', 'x-litellm-model-id': '320c14227ccff7f17d435b101d7243e1ef040b82cc0be675ede6985d5a651827', 'x-litellm-model-api-base': 'http://llama-sea-lion-v3-5-70b-r/v1', 'x-litellm-version': '1.56.3', 'x-litellm-response-cost': '0.0017350000000000002', 'x-litellm-key-tpm-limit': 'None', 'x-litellm-key-rpm-limit': 'None', 'llm_provider-date': 'Sat, 16 Aug 2025 16:53:10 GMT', 'llm_provider-server': 'uvicorn', 'llm_provider-content-length': '503', 'llm_provider-content-type': 'application/json', 'x-litellm-model-group': 'aisingapore/Llama-SEA-LION-v3.5-70B-R'})
2025-08-17 00:53:11,441 - openai._base_client - DEBUG - request_id: None
2025-08-17 00:53:11,508 - middleware.auth_middleware - ERROR - Unhandled error in POST /email/analyze: 'list' object has no attribute 'items'
2025-08-17 00:53:11,508 - middleware.auth_middleware - ERROR - Error type: AttributeError
2025-08-17 00:53:11,508 - middleware.auth_middleware - ERROR - Traceback: Traceback (most recent call last):
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 365, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 304, in __call__
    await self.app(scope, receive, send_with_headers)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\apis\email.py", line 83, in detect
    signals = extract_signals(title=subject, content=content,
                              from_email=from_email, reply_to_email=reply_to_email or "")
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\utils\emailUtils.py", line 231, in extract_signals
    for category, keyword_list in EMAIL_KEYWORDS.items():
                                  ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'list' object has no attribute 'items'

2025-08-17 00:53:11,508 - middleware.auth_middleware - INFO - Response: 500 - 2.675s
2025-08-17 00:53:21,575 - Application Initialization - INFO - MAI Scam Detection API shutting down...
2025-08-17 00:53:21,575 - Application Initialization - INFO - Cleanup operations completed
2025-08-17 00:53:21,576 - Application Initialization - INFO - MAI Scam Detection API shutdown completed
2025-08-17 00:53:25,394 - Application Initialization - INFO - MAI Scam Detection API starting up...
2025-08-17 00:53:25,394 - Application Initialization - INFO - Application state initialized
2025-08-17 00:53:25,394 - Application Initialization - INFO - Authentication middleware enabled
2025-08-17 00:53:25,394 - Application Initialization - INFO - Rate limiting enabled
2025-08-17 00:53:25,395 - Application Initialization - INFO - CORS configured
2025-08-17 00:53:25,395 - Application Initialization - INFO - Security headers enabled
2025-08-17 00:53:25,395 - Application Initialization - INFO - Environment: dev
2025-08-17 00:53:25,395 - Application Initialization - INFO - API Version: 0.0.1
2025-08-17 00:53:25,395 - Application Initialization - INFO - MAI Scam Detection API startup completed successfully
2025-08-17 00:53:27,845 - middleware.auth_middleware - INFO - Request: POST /email/analyze - 2025-08-17 00:53:27.845444
2025-08-17 00:53:28,769 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-0bce5ec4-a748-46c4-9e13-5b4313fe6c7b', 'json_data': {'messages': [{'role': 'user', 'content': '\n[ROLE]\nYou are a precise language identification module for email data in Southeast Asia.\n\n[GOAL]\nReturn ONLY the dominant BASE language of the EMAIL CONTENT as an ISO-639-1 code in lowercase.\n\n[AVAILABLE LANGUAGES]\n```\nen, zh, ms, th, vi\n```\n\n[RULES]\n- Choose from ALLOWED LANGUAGES only. Do not invent new codes (e.g., no "zh-cn", "sg-en").\n- If content is code-mixed, pick the language covering the majority of meaningful tokens in CONTENT.\n- If near-tie, prefer the language used by the majority of complete sentences in CONTENT.\n- Normalize: treat Chinese/Mandarin as "zh"; Bahasa Melayu -> "ms"; Bahasa Indonesia -> "id".\n- Ignore when deciding: URLs, email addresses, numbers, emojis, boilerplate signatures/disclaimers, quoted previous replies, headers like "Re:"/"Fwd:".\n- Be deterministic.\n\n[OUTPUT FORMAT]\nReturn EXACTLY one single-line minified JSON object (no prose, no markdown, no code fences):\n{\n    "base_language":"<iso>"\n}\n\n[EMAIL CONTENT]\n```\nDear valued customer, your account has been suspended due to suspicious activity. Please click the link below to verify your identity and restore access immediately. Failure to do so within 24 hours will result in permanent account closure. https://bit.ly/verify-account-now\n```\n'}], 'model': 'aisingapore/Llama-SEA-LION-v3.5-70B-R'}, 'extra_json': {'chat_template_kwargs': {'thinking_mode': 'off'}, 'cache': {'no-cache': True}}}
2025-08-17 00:53:28,847 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.sea-lion.ai/v1/chat/completions
2025-08-17 00:53:28,848 - httpcore.connection - DEBUG - connect_tcp.started host='api.sea-lion.ai' port=443 local_address=None timeout=5.0 socket_options=None
2025-08-17 00:53:29,126 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001B925065010>
2025-08-17 00:53:29,127 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000001B923BD3260> server_hostname='api.sea-lion.ai' timeout=5.0
2025-08-17 00:53:29,627 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001B924F89A90>
2025-08-17 00:53:29,628 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-17 00:53:29,630 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-08-17 00:53:29,631 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-17 00:53:29,632 - httpcore.http11 - DEBUG - send_request_body.complete
2025-08-17 00:53:29,632 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-17 00:53:30,248 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Sat, 16 Aug 2025 16:53:30 GMT'), (b'Content-Type', b'application/json'), (b'Content-Length', b'545'), (b'Connection', b'keep-alive'), (b'server', b'uvicorn'), (b'x-litellm-call-id', b'e5b601e8-e091-4b06-aff8-295042faa49a'), (b'x-litellm-model-id', b'320c14227ccff7f17d435b101d7243e1ef040b82cc0be675ede6985d5a651827'), (b'x-litellm-model-api-base', b'http://llama-sea-lion-v3-5-70b-r/v1'), (b'x-litellm-version', b'1.56.3'), (b'x-litellm-response-cost', b'0.0017350000000000002'), (b'x-litellm-key-tpm-limit', b'None'), (b'x-litellm-key-rpm-limit', b'None'), (b'llm_provider-date', b'Sat, 16 Aug 2025 16:53:29 GMT'), (b'llm_provider-server', b'uvicorn'), (b'llm_provider-content-length', b'503'), (b'llm_provider-content-type', b'application/json'), (b'x-litellm-model-group', b'aisingapore/Llama-SEA-LION-v3.5-70B-R')])
2025-08-17 00:53:30,249 - httpx - INFO - HTTP Request: POST https://api.sea-lion.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-17 00:53:30,250 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-17 00:53:30,250 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-08-17 00:53:30,250 - httpcore.http11 - DEBUG - response_closed.started
2025-08-17 00:53:30,251 - httpcore.http11 - DEBUG - response_closed.complete
2025-08-17 00:53:30,251 - openai._base_client - DEBUG - HTTP Response: POST https://api.sea-lion.ai/v1/chat/completions "200 OK" Headers({'date': 'Sat, 16 Aug 2025 16:53:30 GMT', 'content-type': 'application/json', 'content-length': '545', 'connection': 'keep-alive', 'server': 'uvicorn', 'x-litellm-call-id': 'e5b601e8-e091-4b06-aff8-295042faa49a', 'x-litellm-model-id': '320c14227ccff7f17d435b101d7243e1ef040b82cc0be675ede6985d5a651827', 'x-litellm-model-api-base': 'http://llama-sea-lion-v3-5-70b-r/v1', 'x-litellm-version': '1.56.3', 'x-litellm-response-cost': '0.0017350000000000002', 'x-litellm-key-tpm-limit': 'None', 'x-litellm-key-rpm-limit': 'None', 'llm_provider-date': 'Sat, 16 Aug 2025 16:53:29 GMT', 'llm_provider-server': 'uvicorn', 'llm_provider-content-length': '503', 'llm_provider-content-type': 'application/json', 'x-litellm-model-group': 'aisingapore/Llama-SEA-LION-v3.5-70B-R'})
2025-08-17 00:53:30,252 - openai._base_client - DEBUG - request_id: None
2025-08-17 00:53:30,264 - middleware.auth_middleware - ERROR - Unhandled error in POST /email/analyze: 'list' object has no attribute 'items'
2025-08-17 00:53:30,264 - middleware.auth_middleware - ERROR - Error type: AttributeError
2025-08-17 00:53:30,264 - middleware.auth_middleware - ERROR - Traceback: Traceback (most recent call last):
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 365, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 304, in __call__
    await self.app(scope, receive, send_with_headers)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\apis\email.py", line 83, in detect
    signals = extract_signals(title=subject, content=content,
                              from_email=from_email, reply_to_email=reply_to_email or "")
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\utils\emailUtils.py", line 231, in extract_signals
    for category, keyword_list in EMAIL_KEYWORDS.items():
                                  ^^^^^^^^^^^^^^^^^^^^
AttributeError: 'list' object has no attribute 'items'

2025-08-17 00:53:30,265 - middleware.auth_middleware - INFO - Response: 500 - 2.420s
2025-08-17 00:54:28,190 - Application Initialization - INFO - MAI Scam Detection API shutting down...
2025-08-17 00:54:28,190 - Application Initialization - INFO - Cleanup operations completed
2025-08-17 00:54:28,190 - Application Initialization - INFO - MAI Scam Detection API shutdown completed
2025-08-17 00:54:32,108 - Application Initialization - INFO - MAI Scam Detection API starting up...
2025-08-17 00:54:32,108 - Application Initialization - INFO - Application state initialized
2025-08-17 00:54:32,108 - Application Initialization - INFO - Authentication middleware enabled
2025-08-17 00:54:32,108 - Application Initialization - INFO - Rate limiting enabled
2025-08-17 00:54:32,108 - Application Initialization - INFO - CORS configured
2025-08-17 00:54:32,109 - Application Initialization - INFO - Security headers enabled
2025-08-17 00:54:32,109 - Application Initialization - INFO - Environment: dev
2025-08-17 00:54:32,109 - Application Initialization - INFO - API Version: 0.0.1
2025-08-17 00:54:32,109 - Application Initialization - INFO - MAI Scam Detection API startup completed successfully
2025-08-17 00:54:36,804 - middleware.auth_middleware - INFO - Request: POST /email/analyze - 2025-08-17 00:54:36.804498
2025-08-17 00:54:37,892 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-9b1b6443-aa6c-471a-8094-6b419d16475b', 'json_data': {'messages': [{'role': 'user', 'content': '\n[ROLE]\nYou are a precise language identification module for email data in Southeast Asia.\n\n[GOAL]\nReturn ONLY the dominant BASE language of the EMAIL CONTENT as an ISO-639-1 code in lowercase.\n\n[AVAILABLE LANGUAGES]\n```\nen, zh, ms, th, vi\n```\n\n[RULES]\n- Choose from ALLOWED LANGUAGES only. Do not invent new codes (e.g., no "zh-cn", "sg-en").\n- If content is code-mixed, pick the language covering the majority of meaningful tokens in CONTENT.\n- If near-tie, prefer the language used by the majority of complete sentences in CONTENT.\n- Normalize: treat Chinese/Mandarin as "zh"; Bahasa Melayu -> "ms"; Bahasa Indonesia -> "id".\n- Ignore when deciding: URLs, email addresses, numbers, emojis, boilerplate signatures/disclaimers, quoted previous replies, headers like "Re:"/"Fwd:".\n- Be deterministic.\n\n[OUTPUT FORMAT]\nReturn EXACTLY one single-line minified JSON object (no prose, no markdown, no code fences):\n{\n    "base_language":"<iso>"\n}\n\n[EMAIL CONTENT]\n```\nDear valued customer, your account has been suspended due to suspicious activity. Please click the link below to verify your identity and restore access immediately. Failure to do so within 24 hours will result in permanent account closure. https://bit.ly/verify-account-now\n```\n'}], 'model': 'aisingapore/Llama-SEA-LION-v3.5-70B-R'}, 'extra_json': {'chat_template_kwargs': {'thinking_mode': 'off'}, 'cache': {'no-cache': True}}}
2025-08-17 00:54:38,009 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.sea-lion.ai/v1/chat/completions
2025-08-17 00:54:38,009 - httpcore.connection - DEBUG - connect_tcp.started host='api.sea-lion.ai' port=443 local_address=None timeout=5.0 socket_options=None
2025-08-17 00:54:38,285 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000028F415F5010>
2025-08-17 00:54:38,286 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000028F40163260> server_hostname='api.sea-lion.ai' timeout=5.0
2025-08-17 00:54:38,811 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x0000028F41519A90>
2025-08-17 00:54:38,812 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-17 00:54:38,813 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-08-17 00:54:38,814 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-17 00:54:38,815 - httpcore.http11 - DEBUG - send_request_body.complete
2025-08-17 00:54:38,815 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-17 00:54:39,421 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Sat, 16 Aug 2025 16:54:39 GMT'), (b'Content-Type', b'application/json'), (b'Content-Length', b'545'), (b'Connection', b'keep-alive'), (b'server', b'uvicorn'), (b'x-litellm-call-id', b'cd8114ca-0afd-4e2f-b30d-1ec396f0e076'), (b'x-litellm-model-id', b'320c14227ccff7f17d435b101d7243e1ef040b82cc0be675ede6985d5a651827'), (b'x-litellm-model-api-base', b'http://llama-sea-lion-v3-5-70b-r/v1'), (b'x-litellm-version', b'1.56.3'), (b'x-litellm-response-cost', b'0.0017350000000000002'), (b'x-litellm-key-tpm-limit', b'None'), (b'x-litellm-key-rpm-limit', b'None'), (b'llm_provider-date', b'Sat, 16 Aug 2025 16:54:38 GMT'), (b'llm_provider-server', b'uvicorn'), (b'llm_provider-content-length', b'503'), (b'llm_provider-content-type', b'application/json'), (b'x-litellm-model-group', b'aisingapore/Llama-SEA-LION-v3.5-70B-R')])
2025-08-17 00:54:39,422 - httpx - INFO - HTTP Request: POST https://api.sea-lion.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-17 00:54:39,423 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-17 00:54:39,423 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-08-17 00:54:39,423 - httpcore.http11 - DEBUG - response_closed.started
2025-08-17 00:54:39,424 - httpcore.http11 - DEBUG - response_closed.complete
2025-08-17 00:54:39,424 - openai._base_client - DEBUG - HTTP Response: POST https://api.sea-lion.ai/v1/chat/completions "200 OK" Headers({'date': 'Sat, 16 Aug 2025 16:54:39 GMT', 'content-type': 'application/json', 'content-length': '545', 'connection': 'keep-alive', 'server': 'uvicorn', 'x-litellm-call-id': 'cd8114ca-0afd-4e2f-b30d-1ec396f0e076', 'x-litellm-model-id': '320c14227ccff7f17d435b101d7243e1ef040b82cc0be675ede6985d5a651827', 'x-litellm-model-api-base': 'http://llama-sea-lion-v3-5-70b-r/v1', 'x-litellm-version': '1.56.3', 'x-litellm-response-cost': '0.0017350000000000002', 'x-litellm-key-tpm-limit': 'None', 'x-litellm-key-rpm-limit': 'None', 'llm_provider-date': 'Sat, 16 Aug 2025 16:54:38 GMT', 'llm_provider-server': 'uvicorn', 'llm_provider-content-length': '503', 'llm_provider-content-type': 'application/json', 'x-litellm-model-group': 'aisingapore/Llama-SEA-LION-v3.5-70B-R'})
2025-08-17 00:54:39,424 - openai._base_client - DEBUG - request_id: None
2025-08-17 00:54:39,621 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.sea-lion.ai/v1/chat/completions
2025-08-17 00:54:39,622 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-17 00:54:39,622 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-08-17 00:54:39,622 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-17 00:54:39,623 - httpcore.http11 - DEBUG - send_request_body.complete
2025-08-17 00:54:39,623 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-17 00:54:42,041 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Sat, 16 Aug 2025 16:54:41 GMT'), (b'Content-Type', b'application/json'), (b'Content-Length', b'1159'), (b'Connection', b'keep-alive'), (b'server', b'uvicorn'), (b'x-litellm-call-id', b'2c6832c4-ae5d-4cd3-81c4-914e8dfac9fa'), (b'x-litellm-model-id', b'320c14227ccff7f17d435b101d7243e1ef040b82cc0be675ede6985d5a651827'), (b'x-litellm-model-api-base', b'http://llama-sea-lion-v3-5-70b-r/v1'), (b'x-litellm-version', b'1.56.3'), (b'x-litellm-response-cost', b'0.0046'), (b'x-litellm-key-tpm-limit', b'None'), (b'x-litellm-key-rpm-limit', b'None'), (b'llm_provider-date', b'Sat, 16 Aug 2025 16:54:39 GMT'), (b'llm_provider-server', b'uvicorn'), (b'llm_provider-content-length', b'1117'), (b'llm_provider-content-type', b'application/json'), (b'x-litellm-model-group', b'aisingapore/Llama-SEA-LION-v3.5-70B-R')])
2025-08-17 00:54:42,043 - httpx - INFO - HTTP Request: POST https://api.sea-lion.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-17 00:54:42,044 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-17 00:54:42,045 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-08-17 00:54:42,046 - httpcore.http11 - DEBUG - response_closed.started
2025-08-17 00:54:42,046 - httpcore.http11 - DEBUG - response_closed.complete
2025-08-17 00:54:42,047 - openai._base_client - DEBUG - HTTP Response: POST https://api.sea-lion.ai/v1/chat/completions "200 OK" Headers({'date': 'Sat, 16 Aug 2025 16:54:41 GMT', 'content-type': 'application/json', 'content-length': '1159', 'connection': 'keep-alive', 'server': 'uvicorn', 'x-litellm-call-id': '2c6832c4-ae5d-4cd3-81c4-914e8dfac9fa', 'x-litellm-model-id': '320c14227ccff7f17d435b101d7243e1ef040b82cc0be675ede6985d5a651827', 'x-litellm-model-api-base': 'http://llama-sea-lion-v3-5-70b-r/v1', 'x-litellm-version': '1.56.3', 'x-litellm-response-cost': '0.0046', 'x-litellm-key-tpm-limit': 'None', 'x-litellm-key-rpm-limit': 'None', 'llm_provider-date': 'Sat, 16 Aug 2025 16:54:39 GMT', 'llm_provider-server': 'uvicorn', 'llm_provider-content-length': '1117', 'llm_provider-content-type': 'application/json', 'x-litellm-model-group': 'aisingapore/Llama-SEA-LION-v3.5-70B-R'})
2025-08-17 00:54:42,048 - openai._base_client - DEBUG - request_id: None
2025-08-17 00:54:42,106 - pymongo.topology - DEBUG - {"message": "Starting topology monitoring", "topologyId": {"$oid": "68a0b7d2db0e78dc702b5aad"}}
2025-08-17 00:54:42,106 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b7d2db0e78dc702b5aad"}, "previousDescription": "<TopologyDescription id: 68a0b7d2db0e78dc702b5aad, topology_type: Unknown, servers: []>", "newDescription": "<TopologyDescription id: 68a0b7d2db0e78dc702b5aad, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>"}
2025-08-17 00:54:42,106 - pymongo.topology - DEBUG - {"message": "Starting server monitoring", "topologyId": {"$oid": "68a0b7d2db0e78dc702b5aad"}, "serverHost": "localhost", "serverPort": 27017}
2025-08-17 00:54:42,107 - pymongo.connection - DEBUG - {"message": "Connection pool created", "clientId": {"$oid": "68a0b7d2db0e78dc702b5aad"}, "serverHost": "localhost", "serverPort": 27017, "maxPoolSize": 50}
2025-08-17 00:54:42,108 - pymongo.serverSelection - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 68a0b7d2db0e78dc702b5aad, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "68a0b7d2db0e78dc702b5aad"}}
2025-08-17 00:54:42,109 - pymongo.serverSelection - DEBUG - {"message": "Waiting for suitable server to become available", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 68a0b7d2db0e78dc702b5aad, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "68a0b7d2db0e78dc702b5aad"}, "remainingTimeMS": 4999}
2025-08-17 00:54:44,132 - pymongo.topology - DEBUG - {"message": "Server heartbeat failed", "topologyId": {"$oid": "68a0b7d2db0e78dc702b5aad"}, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 2024.668500002008, "failure": "\"AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')\""}
2025-08-17 00:54:44,134 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b7d2db0e78dc702b5aad"}, "previousDescription": "<TopologyDescription id: 68a0b7d2db0e78dc702b5aad, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "newDescription": "<TopologyDescription id: 68a0b7d2db0e78dc702b5aad, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>"}
2025-08-17 00:54:46,697 - pymongo.topology - DEBUG - {"message": "Server heartbeat failed", "topologyId": {"$oid": "68a0b7d2db0e78dc702b5aad"}, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 2060.933799977647, "failure": "\"AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')\""}
2025-08-17 00:54:46,699 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b7d2db0e78dc702b5aad"}, "previousDescription": "<TopologyDescription id: 68a0b7d2db0e78dc702b5aad, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "newDescription": "<TopologyDescription id: 68a0b7d2db0e78dc702b5aad, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>"}
2025-08-17 00:54:47,213 - pymongo.serverSelection - DEBUG - {"message": "Server selection failed", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 68a0b7d2db0e78dc702b5aad, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "clientId": {"$oid": "68a0b7d2db0e78dc702b5aad"}, "failure": "\"localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)\""}
2025-08-17 00:54:47,217 - pymongo.serverSelection - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x0000028F3F8EF240>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 68a0b7d2db0e78dc702b5aad, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "clientId": {"$oid": "68a0b7d2db0e78dc702b5aad"}}
2025-08-17 00:54:47,218 - pymongo.serverSelection - DEBUG - {"message": "Waiting for suitable server to become available", "selector": "<function writable_server_selector at 0x0000028F3F8EF240>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 68a0b7d2db0e78dc702b5aad, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "clientId": {"$oid": "68a0b7d2db0e78dc702b5aad"}, "remainingTimeMS": 4998}
2025-08-17 00:54:49,250 - pymongo.topology - DEBUG - {"message": "Server heartbeat failed", "topologyId": {"$oid": "68a0b7d2db0e78dc702b5aad"}, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 2049.4074000162072, "failure": "\"AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')\""}
2025-08-17 00:54:49,253 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b7d2db0e78dc702b5aad"}, "previousDescription": "<TopologyDescription id: 68a0b7d2db0e78dc702b5aad, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "newDescription": "<TopologyDescription id: 68a0b7d2db0e78dc702b5aad, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>"}
2025-08-17 00:54:51,793 - pymongo.topology - DEBUG - {"message": "Server heartbeat failed", "topologyId": {"$oid": "68a0b7d2db0e78dc702b5aad"}, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 2038.705699989805, "failure": "\"AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')\""}
2025-08-17 00:54:51,794 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b7d2db0e78dc702b5aad"}, "previousDescription": "<TopologyDescription id: 68a0b7d2db0e78dc702b5aad, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "newDescription": "<TopologyDescription id: 68a0b7d2db0e78dc702b5aad, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>"}
2025-08-17 00:54:52,311 - pymongo.serverSelection - DEBUG - {"message": "Server selection failed", "selector": "<function writable_server_selector at 0x0000028F3F8EF240>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 68a0b7d2db0e78dc702b5aad, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "clientId": {"$oid": "68a0b7d2db0e78dc702b5aad"}, "failure": "\"localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)\""}
2025-08-17 00:54:52,327 - middleware.auth_middleware - ERROR - Unhandled error in POST /email/analyze: 2 validation errors:
  {'type': 'missing', 'loc': ('response', 'email_id'), 'msg': 'Field required', 'input': {'success': True, 'message': 'Success', 'data': {'email_id': 'temp_b401c236', 'en': {'risk_level': 'high', 'analysis': "The email exhibits strong phishing indicators, including an urgent tone threatening account closure, a shortened link to a non-official domain, and a sender address mimicking a legitimate institution but with a suspicious domain variation ('bankofamerica-secure.com' instead of the official 'bankofamerica.com'). These tactics are commonly used in credential harvesting scams.", 'recommended_action': 'Do not click the link or provide any personal information. Verify account status through the official Bank of America website or mobile app, and report this email to their security team immediately.'}, 'reused': False}, 'timestamp': '2025-08-16T16:54:52.317854', 'status_code': 200}}
  {'type': 'missing', 'loc': ('response', 'analysis'), 'msg': 'Field required', 'input': {'success': True, 'message': 'Success', 'data': {'email_id': 'temp_b401c236', 'en': {'risk_level': 'high', 'analysis': "The email exhibits strong phishing indicators, including an urgent tone threatening account closure, a shortened link to a non-official domain, and a sender address mimicking a legitimate institution but with a suspicious domain variation ('bankofamerica-secure.com' instead of the official 'bankofamerica.com'). These tactics are commonly used in credential harvesting scams.", 'recommended_action': 'Do not click the link or provide any personal information. Verify account status through the official Bank of America website or mobile app, and report this email to their security team immediately.'}, 'reused': False}, 'timestamp': '2025-08-16T16:54:52.317854', 'status_code': 200}}

2025-08-17 00:54:52,327 - middleware.auth_middleware - ERROR - Error type: ResponseValidationError
2025-08-17 00:54:52,327 - middleware.auth_middleware - ERROR - Traceback: Traceback (most recent call last):
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 365, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 304, in __call__
    await self.app(scope, receive, send_with_headers)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\fastapi\routing.py", line 327, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\fastapi\routing.py", line 176, in serialize_response
    raise ResponseValidationError(
        errors=_normalize_errors(errors), body=response_content
    )
fastapi.exceptions.ResponseValidationError: 2 validation errors:
  {'type': 'missing', 'loc': ('response', 'email_id'), 'msg': 'Field required', 'input': {'success': True, 'message': 'Success', 'data': {'email_id': 'temp_b401c236', 'en': {'risk_level': 'high', 'analysis': "The email exhibits strong phishing indicators, including an urgent tone threatening account closure, a shortened link to a non-official domain, and a sender address mimicking a legitimate institution but with a suspicious domain variation ('bankofamerica-secure.com' instead of the official 'bankofamerica.com'). These tactics are commonly used in credential harvesting scams.", 'recommended_action': 'Do not click the link or provide any personal information. Verify account status through the official Bank of America website or mobile app, and report this email to their security team immediately.'}, 'reused': False}, 'timestamp': '2025-08-16T16:54:52.317854', 'status_code': 200}}
  {'type': 'missing', 'loc': ('response', 'analysis'), 'msg': 'Field required', 'input': {'success': True, 'message': 'Success', 'data': {'email_id': 'temp_b401c236', 'en': {'risk_level': 'high', 'analysis': "The email exhibits strong phishing indicators, including an urgent tone threatening account closure, a shortened link to a non-official domain, and a sender address mimicking a legitimate institution but with a suspicious domain variation ('bankofamerica-secure.com' instead of the official 'bankofamerica.com'). These tactics are commonly used in credential harvesting scams.", 'recommended_action': 'Do not click the link or provide any personal information. Verify account status through the official Bank of America website or mobile app, and report this email to their security team immediately.'}, 'reused': False}, 'timestamp': '2025-08-16T16:54:52.317854', 'status_code': 200}}


2025-08-17 00:54:52,328 - middleware.auth_middleware - INFO - Response: 500 - 15.524s
2025-08-17 00:54:54,336 - pymongo.topology - DEBUG - {"message": "Server heartbeat failed", "topologyId": {"$oid": "68a0b7d2db0e78dc702b5aad"}, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 2041.2010000145528, "failure": "\"AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')\""}
2025-08-17 00:54:54,338 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b7d2db0e78dc702b5aad"}, "previousDescription": "<TopologyDescription id: 68a0b7d2db0e78dc702b5aad, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "newDescription": "<TopologyDescription id: 68a0b7d2db0e78dc702b5aad, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>"}
2025-08-17 00:55:06,398 - pymongo.topology - DEBUG - {"message": "Server heartbeat failed", "topologyId": {"$oid": "68a0b7d2db0e78dc702b5aad"}, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 2051.402200013399, "failure": "\"AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')\""}
2025-08-17 00:55:06,399 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b7d2db0e78dc702b5aad"}, "previousDescription": "<TopologyDescription id: 68a0b7d2db0e78dc702b5aad, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "newDescription": "<TopologyDescription id: 68a0b7d2db0e78dc702b5aad, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>"}
2025-08-17 00:55:07,980 - Application Initialization - INFO - MAI Scam Detection API shutting down...
2025-08-17 00:55:07,981 - Application Initialization - INFO - Cleanup operations completed
2025-08-17 00:55:07,981 - Application Initialization - INFO - MAI Scam Detection API shutdown completed
2025-08-17 00:55:08,573 - httpcore.connection - DEBUG - close.started
2025-08-17 00:55:08,574 - httpcore.connection - DEBUG - close.complete
2025-08-17 00:55:12,578 - Application Initialization - INFO - MAI Scam Detection API starting up...
2025-08-17 00:55:12,578 - Application Initialization - INFO - Application state initialized
2025-08-17 00:55:12,578 - Application Initialization - INFO - Authentication middleware enabled
2025-08-17 00:55:12,579 - Application Initialization - INFO - Rate limiting enabled
2025-08-17 00:55:12,579 - Application Initialization - INFO - CORS configured
2025-08-17 00:55:12,579 - Application Initialization - INFO - Security headers enabled
2025-08-17 00:55:12,579 - Application Initialization - INFO - Environment: dev
2025-08-17 00:55:12,580 - Application Initialization - INFO - API Version: 0.0.1
2025-08-17 00:55:12,580 - Application Initialization - INFO - MAI Scam Detection API startup completed successfully
2025-08-17 00:55:13,869 - middleware.auth_middleware - INFO - Request: POST /email/analyze - 2025-08-17 00:55:13.869297
2025-08-17 00:55:14,744 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-387039f5-2968-4c0b-bebb-e7accf07d40a', 'json_data': {'messages': [{'role': 'user', 'content': '\n[ROLE]\nYou are a precise language identification module for email data in Southeast Asia.\n\n[GOAL]\nReturn ONLY the dominant BASE language of the EMAIL CONTENT as an ISO-639-1 code in lowercase.\n\n[AVAILABLE LANGUAGES]\n```\nen, zh, ms, th, vi\n```\n\n[RULES]\n- Choose from ALLOWED LANGUAGES only. Do not invent new codes (e.g., no "zh-cn", "sg-en").\n- If content is code-mixed, pick the language covering the majority of meaningful tokens in CONTENT.\n- If near-tie, prefer the language used by the majority of complete sentences in CONTENT.\n- Normalize: treat Chinese/Mandarin as "zh"; Bahasa Melayu -> "ms"; Bahasa Indonesia -> "id".\n- Ignore when deciding: URLs, email addresses, numbers, emojis, boilerplate signatures/disclaimers, quoted previous replies, headers like "Re:"/"Fwd:".\n- Be deterministic.\n\n[OUTPUT FORMAT]\nReturn EXACTLY one single-line minified JSON object (no prose, no markdown, no code fences):\n{\n    "base_language":"<iso>"\n}\n\n[EMAIL CONTENT]\n```\nDear valued customer, your account has been suspended due to suspicious activity. Please click the link below to verify your identity and restore access immediately. Failure to do so within 24 hours will result in permanent account closure. https://bit.ly/verify-account-now\n```\n'}], 'model': 'aisingapore/Llama-SEA-LION-v3.5-70B-R'}, 'extra_json': {'chat_template_kwargs': {'thinking_mode': 'off'}, 'cache': {'no-cache': True}}}
2025-08-17 00:55:14,823 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.sea-lion.ai/v1/chat/completions
2025-08-17 00:55:14,823 - httpcore.connection - DEBUG - connect_tcp.started host='api.sea-lion.ai' port=443 local_address=None timeout=5.0 socket_options=None
2025-08-17 00:55:15,097 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002410D165010>
2025-08-17 00:55:15,098 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000002410BCD3260> server_hostname='api.sea-lion.ai' timeout=5.0
2025-08-17 00:55:15,584 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000002410D089A90>
2025-08-17 00:55:15,586 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-17 00:55:15,587 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-08-17 00:55:15,588 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-17 00:55:15,589 - httpcore.http11 - DEBUG - send_request_body.complete
2025-08-17 00:55:15,590 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-17 00:55:18,325 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Sat, 16 Aug 2025 16:55:18 GMT'), (b'Content-Type', b'application/json'), (b'Content-Length', b'545'), (b'Connection', b'keep-alive'), (b'server', b'uvicorn'), (b'x-litellm-call-id', b'e4a5a6c0-7db2-4a79-834d-75228739f5e6'), (b'x-litellm-model-id', b'320c14227ccff7f17d435b101d7243e1ef040b82cc0be675ede6985d5a651827'), (b'x-litellm-model-api-base', b'http://llama-sea-lion-v3-5-70b-r/v1'), (b'x-litellm-version', b'1.56.3'), (b'x-litellm-response-cost', b'0.0017350000000000002'), (b'x-litellm-key-tpm-limit', b'None'), (b'x-litellm-key-rpm-limit', b'None'), (b'llm_provider-date', b'Sat, 16 Aug 2025 16:55:17 GMT'), (b'llm_provider-server', b'uvicorn'), (b'llm_provider-content-length', b'503'), (b'llm_provider-content-type', b'application/json'), (b'x-litellm-model-group', b'aisingapore/Llama-SEA-LION-v3.5-70B-R')])
2025-08-17 00:55:18,327 - httpx - INFO - HTTP Request: POST https://api.sea-lion.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-17 00:55:18,328 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-17 00:55:18,329 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-08-17 00:55:18,330 - httpcore.http11 - DEBUG - response_closed.started
2025-08-17 00:55:18,330 - httpcore.http11 - DEBUG - response_closed.complete
2025-08-17 00:55:18,331 - openai._base_client - DEBUG - HTTP Response: POST https://api.sea-lion.ai/v1/chat/completions "200 OK" Headers({'date': 'Sat, 16 Aug 2025 16:55:18 GMT', 'content-type': 'application/json', 'content-length': '545', 'connection': 'keep-alive', 'server': 'uvicorn', 'x-litellm-call-id': 'e4a5a6c0-7db2-4a79-834d-75228739f5e6', 'x-litellm-model-id': '320c14227ccff7f17d435b101d7243e1ef040b82cc0be675ede6985d5a651827', 'x-litellm-model-api-base': 'http://llama-sea-lion-v3-5-70b-r/v1', 'x-litellm-version': '1.56.3', 'x-litellm-response-cost': '0.0017350000000000002', 'x-litellm-key-tpm-limit': 'None', 'x-litellm-key-rpm-limit': 'None', 'llm_provider-date': 'Sat, 16 Aug 2025 16:55:17 GMT', 'llm_provider-server': 'uvicorn', 'llm_provider-content-length': '503', 'llm_provider-content-type': 'application/json', 'x-litellm-model-group': 'aisingapore/Llama-SEA-LION-v3.5-70B-R'})
2025-08-17 00:55:18,332 - openai._base_client - DEBUG - request_id: None
2025-08-17 00:55:18,361 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.sea-lion.ai/v1/chat/completions
2025-08-17 00:55:18,362 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-17 00:55:18,362 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-08-17 00:55:18,362 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-17 00:55:18,363 - httpcore.http11 - DEBUG - send_request_body.complete
2025-08-17 00:55:18,363 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-17 00:55:20,423 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Sat, 16 Aug 2025 16:55:20 GMT'), (b'Content-Type', b'application/json'), (b'Content-Length', b'982'), (b'Connection', b'keep-alive'), (b'server', b'uvicorn'), (b'x-litellm-call-id', b'd11441b3-4fc6-491e-aa89-a8701abd563e'), (b'x-litellm-model-id', b'320c14227ccff7f17d435b101d7243e1ef040b82cc0be675ede6985d5a651827'), (b'x-litellm-model-api-base', b'http://llama-sea-lion-v3-5-70b-r/v1'), (b'x-litellm-version', b'1.56.3'), (b'x-litellm-response-cost', b'0.004285000000000001'), (b'x-litellm-key-tpm-limit', b'None'), (b'x-litellm-key-rpm-limit', b'None'), (b'llm_provider-date', b'Sat, 16 Aug 2025 16:55:17 GMT'), (b'llm_provider-server', b'uvicorn'), (b'llm_provider-content-length', b'940'), (b'llm_provider-content-type', b'application/json'), (b'x-litellm-model-group', b'aisingapore/Llama-SEA-LION-v3.5-70B-R')])
2025-08-17 00:55:20,424 - httpx - INFO - HTTP Request: POST https://api.sea-lion.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-17 00:55:20,425 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-17 00:55:20,425 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-08-17 00:55:20,426 - httpcore.http11 - DEBUG - response_closed.started
2025-08-17 00:55:20,426 - httpcore.http11 - DEBUG - response_closed.complete
2025-08-17 00:55:20,427 - openai._base_client - DEBUG - HTTP Response: POST https://api.sea-lion.ai/v1/chat/completions "200 OK" Headers({'date': 'Sat, 16 Aug 2025 16:55:20 GMT', 'content-type': 'application/json', 'content-length': '982', 'connection': 'keep-alive', 'server': 'uvicorn', 'x-litellm-call-id': 'd11441b3-4fc6-491e-aa89-a8701abd563e', 'x-litellm-model-id': '320c14227ccff7f17d435b101d7243e1ef040b82cc0be675ede6985d5a651827', 'x-litellm-model-api-base': 'http://llama-sea-lion-v3-5-70b-r/v1', 'x-litellm-version': '1.56.3', 'x-litellm-response-cost': '0.004285000000000001', 'x-litellm-key-tpm-limit': 'None', 'x-litellm-key-rpm-limit': 'None', 'llm_provider-date': 'Sat, 16 Aug 2025 16:55:17 GMT', 'llm_provider-server': 'uvicorn', 'llm_provider-content-length': '940', 'llm_provider-content-type': 'application/json', 'x-litellm-model-group': 'aisingapore/Llama-SEA-LION-v3.5-70B-R'})
2025-08-17 00:55:20,427 - openai._base_client - DEBUG - request_id: None
2025-08-17 00:55:20,435 - pymongo.topology - DEBUG - {"message": "Starting topology monitoring", "topologyId": {"$oid": "68a0b7f81c59699f95085dbd"}}
2025-08-17 00:55:20,435 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b7f81c59699f95085dbd"}, "previousDescription": "<TopologyDescription id: 68a0b7f81c59699f95085dbd, topology_type: Unknown, servers: []>", "newDescription": "<TopologyDescription id: 68a0b7f81c59699f95085dbd, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>"}
2025-08-17 00:55:20,436 - pymongo.topology - DEBUG - {"message": "Starting server monitoring", "topologyId": {"$oid": "68a0b7f81c59699f95085dbd"}, "serverHost": "localhost", "serverPort": 27017}
2025-08-17 00:55:20,436 - pymongo.connection - DEBUG - {"message": "Connection pool created", "clientId": {"$oid": "68a0b7f81c59699f95085dbd"}, "serverHost": "localhost", "serverPort": 27017, "maxPoolSize": 50}
2025-08-17 00:55:20,438 - pymongo.serverSelection - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 68a0b7f81c59699f95085dbd, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "68a0b7f81c59699f95085dbd"}}
2025-08-17 00:55:20,438 - pymongo.serverSelection - DEBUG - {"message": "Waiting for suitable server to become available", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 68a0b7f81c59699f95085dbd, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "68a0b7f81c59699f95085dbd"}, "remainingTimeMS": 4999}
2025-08-17 00:55:22,468 - pymongo.topology - DEBUG - {"message": "Server heartbeat failed", "topologyId": {"$oid": "68a0b7f81c59699f95085dbd"}, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 2030.9505999903195, "failure": "\"AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')\""}
2025-08-17 00:55:22,470 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b7f81c59699f95085dbd"}, "previousDescription": "<TopologyDescription id: 68a0b7f81c59699f95085dbd, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "newDescription": "<TopologyDescription id: 68a0b7f81c59699f95085dbd, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>"}
2025-08-17 00:55:24,998 - pymongo.topology - DEBUG - {"message": "Server heartbeat failed", "topologyId": {"$oid": "68a0b7f81c59699f95085dbd"}, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 2026.6540999873541, "failure": "\"AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')\""}
2025-08-17 00:55:24,999 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b7f81c59699f95085dbd"}, "previousDescription": "<TopologyDescription id: 68a0b7f81c59699f95085dbd, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "newDescription": "<TopologyDescription id: 68a0b7f81c59699f95085dbd, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>"}
2025-08-17 00:55:25,513 - pymongo.serverSelection - DEBUG - {"message": "Server selection failed", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 68a0b7f81c59699f95085dbd, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "clientId": {"$oid": "68a0b7f81c59699f95085dbd"}, "failure": "\"localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)\""}
2025-08-17 00:55:25,515 - pymongo.serverSelection - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x000002410B45F240>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 68a0b7f81c59699f95085dbd, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "clientId": {"$oid": "68a0b7f81c59699f95085dbd"}}
2025-08-17 00:55:25,515 - pymongo.serverSelection - DEBUG - {"message": "Waiting for suitable server to become available", "selector": "<function writable_server_selector at 0x000002410B45F240>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 68a0b7f81c59699f95085dbd, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "clientId": {"$oid": "68a0b7f81c59699f95085dbd"}, "remainingTimeMS": 4999}
2025-08-17 00:55:27,556 - pymongo.topology - DEBUG - {"message": "Server heartbeat failed", "topologyId": {"$oid": "68a0b7f81c59699f95085dbd"}, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 2056.6314999887254, "failure": "\"AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')\""}
2025-08-17 00:55:27,557 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b7f81c59699f95085dbd"}, "previousDescription": "<TopologyDescription id: 68a0b7f81c59699f95085dbd, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "newDescription": "<TopologyDescription id: 68a0b7f81c59699f95085dbd, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>"}
2025-08-17 00:55:30,085 - pymongo.topology - DEBUG - {"message": "Server heartbeat failed", "topologyId": {"$oid": "68a0b7f81c59699f95085dbd"}, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 2027.2770999872591, "failure": "\"AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')\""}
2025-08-17 00:55:30,086 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b7f81c59699f95085dbd"}, "previousDescription": "<TopologyDescription id: 68a0b7f81c59699f95085dbd, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "newDescription": "<TopologyDescription id: 68a0b7f81c59699f95085dbd, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>"}
2025-08-17 00:55:30,599 - pymongo.serverSelection - DEBUG - {"message": "Server selection failed", "selector": "<function writable_server_selector at 0x000002410B45F240>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 68a0b7f81c59699f95085dbd, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "clientId": {"$oid": "68a0b7f81c59699f95085dbd"}, "failure": "\"localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)\""}
2025-08-17 00:55:30,602 - middleware.auth_middleware - ERROR - Unhandled error in POST /email/analyze: 2 validation errors:
  {'type': 'missing', 'loc': ('response', 'email_id'), 'msg': 'Field required', 'input': {'success': True, 'message': 'Success', 'data': {'email_id': 'temp_b268fc1d', 'en': {'risk_level': 'high', 'analysis': "The email exhibits high-risk phishing indicators: urgent language, a shortened link, and an account suspension threat. The sender domain 'bankofamerica-secure.com' appears to be a spoofed variation of the legitimate 'bankofamerica.com'.", 'recommended_action': "Do not click the link. Verify account status via the official Bank of America website or mobile app. Report the email to the bank's fraud department."}, 'reused': False}, 'timestamp': '2025-08-16T16:55:30.599914', 'status_code': 200}}
  {'type': 'missing', 'loc': ('response', 'analysis'), 'msg': 'Field required', 'input': {'success': True, 'message': 'Success', 'data': {'email_id': 'temp_b268fc1d', 'en': {'risk_level': 'high', 'analysis': "The email exhibits high-risk phishing indicators: urgent language, a shortened link, and an account suspension threat. The sender domain 'bankofamerica-secure.com' appears to be a spoofed variation of the legitimate 'bankofamerica.com'.", 'recommended_action': "Do not click the link. Verify account status via the official Bank of America website or mobile app. Report the email to the bank's fraud department."}, 'reused': False}, 'timestamp': '2025-08-16T16:55:30.599914', 'status_code': 200}}

2025-08-17 00:55:30,602 - middleware.auth_middleware - ERROR - Error type: ResponseValidationError
2025-08-17 00:55:30,602 - middleware.auth_middleware - ERROR - Traceback: Traceback (most recent call last):
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 365, in __call__
    await self.app(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 304, in __call__
    await self.app(scope, receive, send_with_headers)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\fastapi\routing.py", line 327, in app
    content = await serialize_response(
              ^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\fastapi\routing.py", line 176, in serialize_response
    raise ResponseValidationError(
        errors=_normalize_errors(errors), body=response_content
    )
fastapi.exceptions.ResponseValidationError: 2 validation errors:
  {'type': 'missing', 'loc': ('response', 'email_id'), 'msg': 'Field required', 'input': {'success': True, 'message': 'Success', 'data': {'email_id': 'temp_b268fc1d', 'en': {'risk_level': 'high', 'analysis': "The email exhibits high-risk phishing indicators: urgent language, a shortened link, and an account suspension threat. The sender domain 'bankofamerica-secure.com' appears to be a spoofed variation of the legitimate 'bankofamerica.com'.", 'recommended_action': "Do not click the link. Verify account status via the official Bank of America website or mobile app. Report the email to the bank's fraud department."}, 'reused': False}, 'timestamp': '2025-08-16T16:55:30.599914', 'status_code': 200}}
  {'type': 'missing', 'loc': ('response', 'analysis'), 'msg': 'Field required', 'input': {'success': True, 'message': 'Success', 'data': {'email_id': 'temp_b268fc1d', 'en': {'risk_level': 'high', 'analysis': "The email exhibits high-risk phishing indicators: urgent language, a shortened link, and an account suspension threat. The sender domain 'bankofamerica-secure.com' appears to be a spoofed variation of the legitimate 'bankofamerica.com'.", 'recommended_action': "Do not click the link. Verify account status via the official Bank of America website or mobile app. Report the email to the bank's fraud department."}, 'reused': False}, 'timestamp': '2025-08-16T16:55:30.599914', 'status_code': 200}}


2025-08-17 00:55:30,602 - middleware.auth_middleware - INFO - Response: 500 - 16.734s
2025-08-17 00:55:32,623 - pymongo.topology - DEBUG - {"message": "Server heartbeat failed", "topologyId": {"$oid": "68a0b7f81c59699f95085dbd"}, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 2036.1027999897487, "failure": "\"AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')\""}
2025-08-17 00:55:32,623 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b7f81c59699f95085dbd"}, "previousDescription": "<TopologyDescription id: 68a0b7f81c59699f95085dbd, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "newDescription": "<TopologyDescription id: 68a0b7f81c59699f95085dbd, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>"}
2025-08-17 00:55:44,715 - pymongo.topology - DEBUG - {"message": "Server heartbeat failed", "topologyId": {"$oid": "68a0b7f81c59699f95085dbd"}, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 2058.464100002311, "failure": "\"AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')\""}
2025-08-17 00:55:44,716 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b7f81c59699f95085dbd"}, "previousDescription": "<TopologyDescription id: 68a0b7f81c59699f95085dbd, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "newDescription": "<TopologyDescription id: 68a0b7f81c59699f95085dbd, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>"}
2025-08-17 00:55:56,788 - pymongo.topology - DEBUG - {"message": "Server heartbeat failed", "topologyId": {"$oid": "68a0b7f81c59699f95085dbd"}, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 2062.1878000092693, "failure": "\"AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')\""}
2025-08-17 00:55:56,789 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b7f81c59699f95085dbd"}, "previousDescription": "<TopologyDescription id: 68a0b7f81c59699f95085dbd, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "newDescription": "<TopologyDescription id: 68a0b7f81c59699f95085dbd, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>"}
2025-08-17 00:56:08,816 - pymongo.topology - DEBUG - {"message": "Server heartbeat failed", "topologyId": {"$oid": "68a0b7f81c59699f95085dbd"}, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 2020.860899996478, "failure": "\"AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')\""}
2025-08-17 00:56:08,817 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b7f81c59699f95085dbd"}, "previousDescription": "<TopologyDescription id: 68a0b7f81c59699f95085dbd, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "newDescription": "<TopologyDescription id: 68a0b7f81c59699f95085dbd, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>"}
2025-08-17 00:56:20,875 - pymongo.topology - DEBUG - {"message": "Server heartbeat failed", "topologyId": {"$oid": "68a0b7f81c59699f95085dbd"}, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 2048.697499994887, "failure": "\"AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')\""}
2025-08-17 00:56:20,878 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b7f81c59699f95085dbd"}, "previousDescription": "<TopologyDescription id: 68a0b7f81c59699f95085dbd, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "newDescription": "<TopologyDescription id: 68a0b7f81c59699f95085dbd, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>"}
2025-08-17 00:56:32,932 - pymongo.topology - DEBUG - {"message": "Server heartbeat failed", "topologyId": {"$oid": "68a0b7f81c59699f95085dbd"}, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 2030.5231000238564, "failure": "\"AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')\""}
2025-08-17 00:56:32,934 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b7f81c59699f95085dbd"}, "previousDescription": "<TopologyDescription id: 68a0b7f81c59699f95085dbd, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "newDescription": "<TopologyDescription id: 68a0b7f81c59699f95085dbd, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>"}
2025-08-17 00:56:37,211 - Application Initialization - INFO - MAI Scam Detection API shutting down...
2025-08-17 00:56:37,211 - Application Initialization - INFO - Cleanup operations completed
2025-08-17 00:56:37,211 - Application Initialization - INFO - MAI Scam Detection API shutdown completed
2025-08-17 00:56:37,561 - httpcore.connection - DEBUG - close.started
2025-08-17 00:56:37,562 - httpcore.connection - DEBUG - close.complete
2025-08-17 00:56:40,956 - Application Initialization - INFO - MAI Scam Detection API starting up...
2025-08-17 00:56:40,957 - Application Initialization - INFO - Application state initialized
2025-08-17 00:56:40,957 - Application Initialization - INFO - Authentication middleware enabled
2025-08-17 00:56:40,957 - Application Initialization - INFO - Rate limiting enabled
2025-08-17 00:56:40,957 - Application Initialization - INFO - CORS configured
2025-08-17 00:56:40,958 - Application Initialization - INFO - Security headers enabled
2025-08-17 00:56:40,958 - Application Initialization - INFO - Environment: dev
2025-08-17 00:56:40,958 - Application Initialization - INFO - API Version: 0.0.1
2025-08-17 00:56:40,958 - Application Initialization - INFO - MAI Scam Detection API startup completed successfully
2025-08-17 00:56:42,386 - middleware.auth_middleware - INFO - Request: POST /email/analyze - 2025-08-17 00:56:42.386236
2025-08-17 00:56:43,163 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-4cb5309a-a714-4bd3-996c-eca59a7de369', 'json_data': {'messages': [{'role': 'user', 'content': '\n[ROLE]\nYou are a precise language identification module for email data in Southeast Asia.\n\n[GOAL]\nReturn ONLY the dominant BASE language of the EMAIL CONTENT as an ISO-639-1 code in lowercase.\n\n[AVAILABLE LANGUAGES]\n```\nen, zh, ms, th, vi\n```\n\n[RULES]\n- Choose from ALLOWED LANGUAGES only. Do not invent new codes (e.g., no "zh-cn", "sg-en").\n- If content is code-mixed, pick the language covering the majority of meaningful tokens in CONTENT.\n- If near-tie, prefer the language used by the majority of complete sentences in CONTENT.\n- Normalize: treat Chinese/Mandarin as "zh"; Bahasa Melayu -> "ms"; Bahasa Indonesia -> "id".\n- Ignore when deciding: URLs, email addresses, numbers, emojis, boilerplate signatures/disclaimers, quoted previous replies, headers like "Re:"/"Fwd:".\n- Be deterministic.\n\n[OUTPUT FORMAT]\nReturn EXACTLY one single-line minified JSON object (no prose, no markdown, no code fences):\n{\n    "base_language":"<iso>"\n}\n\n[EMAIL CONTENT]\n```\nDear valued customer, your account has been suspended due to suspicious activity. Please click the link below to verify your identity and restore access immediately. Failure to do so within 24 hours will result in permanent account closure. https://bit.ly/verify-account-now\n```\n'}], 'model': 'aisingapore/Llama-SEA-LION-v3.5-70B-R'}, 'extra_json': {'chat_template_kwargs': {'thinking_mode': 'off'}, 'cache': {'no-cache': True}}}
2025-08-17 00:56:43,240 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.sea-lion.ai/v1/chat/completions
2025-08-17 00:56:43,241 - httpcore.connection - DEBUG - connect_tcp.started host='api.sea-lion.ai' port=443 local_address=None timeout=5.0 socket_options=None
2025-08-17 00:56:43,680 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001B2DD661010>
2025-08-17 00:56:43,681 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000001B2DC1D2F00> server_hostname='api.sea-lion.ai' timeout=5.0
2025-08-17 00:56:44,165 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001B2DD585A90>
2025-08-17 00:56:44,166 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-17 00:56:44,168 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-08-17 00:56:44,169 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-17 00:56:44,170 - httpcore.http11 - DEBUG - send_request_body.complete
2025-08-17 00:56:44,171 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-17 00:56:44,768 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Sat, 16 Aug 2025 16:56:44 GMT'), (b'Content-Type', b'application/json'), (b'Content-Length', b'545'), (b'Connection', b'keep-alive'), (b'server', b'uvicorn'), (b'x-litellm-call-id', b'2277018d-ba72-444e-bf2d-2defbae5f32a'), (b'x-litellm-model-id', b'320c14227ccff7f17d435b101d7243e1ef040b82cc0be675ede6985d5a651827'), (b'x-litellm-model-api-base', b'http://llama-sea-lion-v3-5-70b-r/v1'), (b'x-litellm-version', b'1.56.3'), (b'x-litellm-response-cost', b'0.0017350000000000002'), (b'x-litellm-key-tpm-limit', b'None'), (b'x-litellm-key-rpm-limit', b'None'), (b'llm_provider-date', b'Sat, 16 Aug 2025 16:56:44 GMT'), (b'llm_provider-server', b'uvicorn'), (b'llm_provider-content-length', b'503'), (b'llm_provider-content-type', b'application/json'), (b'x-litellm-model-group', b'aisingapore/Llama-SEA-LION-v3.5-70B-R')])
2025-08-17 00:56:44,771 - httpx - INFO - HTTP Request: POST https://api.sea-lion.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-17 00:56:44,772 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-17 00:56:44,774 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-08-17 00:56:44,775 - httpcore.http11 - DEBUG - response_closed.started
2025-08-17 00:56:44,775 - httpcore.http11 - DEBUG - response_closed.complete
2025-08-17 00:56:44,776 - openai._base_client - DEBUG - HTTP Response: POST https://api.sea-lion.ai/v1/chat/completions "200 OK" Headers({'date': 'Sat, 16 Aug 2025 16:56:44 GMT', 'content-type': 'application/json', 'content-length': '545', 'connection': 'keep-alive', 'server': 'uvicorn', 'x-litellm-call-id': '2277018d-ba72-444e-bf2d-2defbae5f32a', 'x-litellm-model-id': '320c14227ccff7f17d435b101d7243e1ef040b82cc0be675ede6985d5a651827', 'x-litellm-model-api-base': 'http://llama-sea-lion-v3-5-70b-r/v1', 'x-litellm-version': '1.56.3', 'x-litellm-response-cost': '0.0017350000000000002', 'x-litellm-key-tpm-limit': 'None', 'x-litellm-key-rpm-limit': 'None', 'llm_provider-date': 'Sat, 16 Aug 2025 16:56:44 GMT', 'llm_provider-server': 'uvicorn', 'llm_provider-content-length': '503', 'llm_provider-content-type': 'application/json', 'x-litellm-model-group': 'aisingapore/Llama-SEA-LION-v3.5-70B-R'})
2025-08-17 00:56:44,777 - openai._base_client - DEBUG - request_id: None
2025-08-17 00:56:44,860 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.sea-lion.ai/v1/chat/completions
2025-08-17 00:56:44,860 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-17 00:56:44,861 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-08-17 00:56:44,861 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-17 00:56:44,861 - httpcore.http11 - DEBUG - send_request_body.complete
2025-08-17 00:56:44,861 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-17 00:56:47,164 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Sat, 16 Aug 2025 16:56:47 GMT'), (b'Content-Type', b'application/json'), (b'Content-Length', b'1041'), (b'Connection', b'keep-alive'), (b'server', b'uvicorn'), (b'x-litellm-call-id', b'3d6b83c0-97b3-43ac-8814-6fcd9c580a3a'), (b'x-litellm-model-id', b'320c14227ccff7f17d435b101d7243e1ef040b82cc0be675ede6985d5a651827'), (b'x-litellm-model-api-base', b'http://llama-sea-lion-v3-5-70b-r/v1'), (b'x-litellm-version', b'1.56.3'), (b'x-litellm-response-cost', b'0.00436'), (b'x-litellm-key-tpm-limit', b'None'), (b'x-litellm-key-rpm-limit', b'None'), (b'llm_provider-date', b'Sat, 16 Aug 2025 16:56:45 GMT'), (b'llm_provider-server', b'uvicorn'), (b'llm_provider-content-length', b'999'), (b'llm_provider-content-type', b'application/json'), (b'x-litellm-model-group', b'aisingapore/Llama-SEA-LION-v3.5-70B-R')])
2025-08-17 00:56:47,166 - httpx - INFO - HTTP Request: POST https://api.sea-lion.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-17 00:56:47,167 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-17 00:56:47,168 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-08-17 00:56:47,169 - httpcore.http11 - DEBUG - response_closed.started
2025-08-17 00:56:47,170 - httpcore.http11 - DEBUG - response_closed.complete
2025-08-17 00:56:47,171 - openai._base_client - DEBUG - HTTP Response: POST https://api.sea-lion.ai/v1/chat/completions "200 OK" Headers({'date': 'Sat, 16 Aug 2025 16:56:47 GMT', 'content-type': 'application/json', 'content-length': '1041', 'connection': 'keep-alive', 'server': 'uvicorn', 'x-litellm-call-id': '3d6b83c0-97b3-43ac-8814-6fcd9c580a3a', 'x-litellm-model-id': '320c14227ccff7f17d435b101d7243e1ef040b82cc0be675ede6985d5a651827', 'x-litellm-model-api-base': 'http://llama-sea-lion-v3-5-70b-r/v1', 'x-litellm-version': '1.56.3', 'x-litellm-response-cost': '0.00436', 'x-litellm-key-tpm-limit': 'None', 'x-litellm-key-rpm-limit': 'None', 'llm_provider-date': 'Sat, 16 Aug 2025 16:56:45 GMT', 'llm_provider-server': 'uvicorn', 'llm_provider-content-length': '999', 'llm_provider-content-type': 'application/json', 'x-litellm-model-group': 'aisingapore/Llama-SEA-LION-v3.5-70B-R'})
2025-08-17 00:56:47,173 - openai._base_client - DEBUG - request_id: None
2025-08-17 00:56:47,184 - pymongo.topology - DEBUG - {"message": "Starting topology monitoring", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}}
2025-08-17 00:56:47,185 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "previousDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: []>", "newDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>"}
2025-08-17 00:56:47,186 - pymongo.topology - DEBUG - {"message": "Starting server monitoring", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "serverHost": "localhost", "serverPort": 27017}
2025-08-17 00:56:47,187 - pymongo.connection - DEBUG - {"message": "Connection pool created", "clientId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "serverHost": "localhost", "serverPort": 27017, "maxPoolSize": 50}
2025-08-17 00:56:47,190 - pymongo.serverSelection - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}}
2025-08-17 00:56:47,190 - pymongo.serverSelection - DEBUG - {"message": "Waiting for suitable server to become available", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "clientId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "remainingTimeMS": 4999}
2025-08-17 00:56:49,216 - pymongo.topology - DEBUG - {"message": "Server heartbeat failed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 2026.9696000032127, "failure": "\"AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')\""}
2025-08-17 00:56:49,218 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "previousDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None>]>", "newDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>"}
2025-08-17 00:56:51,759 - pymongo.topology - DEBUG - {"message": "Server heartbeat failed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 2039.3343000032473, "failure": "\"AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')\""}
2025-08-17 00:56:51,763 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "previousDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "newDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>"}
2025-08-17 00:56:52,273 - pymongo.serverSelection - DEBUG - {"message": "Server selection failed", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "clientId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "failure": "\"localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)\""}
2025-08-17 00:56:52,276 - pymongo.serverSelection - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x000001B2DB94F240>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "clientId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}}
2025-08-17 00:56:52,277 - pymongo.serverSelection - DEBUG - {"message": "Waiting for suitable server to become available", "selector": "<function writable_server_selector at 0x000001B2DB94F240>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "clientId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "remainingTimeMS": 4998}
2025-08-17 00:56:54,301 - pymongo.topology - DEBUG - {"message": "Server heartbeat failed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 2035.8210999984294, "failure": "\"AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')\""}
2025-08-17 00:56:54,303 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "previousDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "newDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>"}
2025-08-17 00:56:56,836 - pymongo.topology - DEBUG - {"message": "Server heartbeat failed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 2031.6560000064783, "failure": "\"AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')\""}
2025-08-17 00:56:56,838 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "previousDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "newDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>"}
2025-08-17 00:56:57,353 - pymongo.serverSelection - DEBUG - {"message": "Server selection failed", "selector": "<function writable_server_selector at 0x000001B2DB94F240>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "clientId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "failure": "\"localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)\""}
2025-08-17 00:56:57,357 - middleware.auth_middleware - INFO - Response: 200 - 14.971s
2025-08-17 00:56:59,406 - pymongo.topology - DEBUG - {"message": "Server heartbeat failed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 2066.283399995882, "failure": "\"AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')\""}
2025-08-17 00:56:59,408 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "previousDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "newDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>"}
2025-08-17 00:57:11,470 - pymongo.topology - DEBUG - {"message": "Server heartbeat failed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 2052.0340999937616, "failure": "\"AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')\""}
2025-08-17 00:57:11,471 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "previousDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "newDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>"}
2025-08-17 00:57:23,526 - pymongo.topology - DEBUG - {"message": "Server heartbeat failed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 2047.5327000021935, "failure": "\"AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')\""}
2025-08-17 00:57:23,527 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "previousDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "newDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>"}
2025-08-17 00:57:33,496 - middleware.auth_middleware - INFO - Request: POST /email/analyze - 2025-08-17 00:57:33.496665
2025-08-17 00:57:33,499 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-3e4b74cf-5928-434b-964d-1618ec3aec13', 'json_data': {'messages': [{'role': 'user', 'content': '\n[ROLE]\nYou are a precise language identification module for email data in Southeast Asia.\n\n[GOAL]\nReturn ONLY the dominant BASE language of the EMAIL CONTENT as an ISO-639-1 code in lowercase.\n\n[AVAILABLE LANGUAGES]\n```\nen, zh, ms, th, vi\n```\n\n[RULES]\n- Choose from ALLOWED LANGUAGES only. Do not invent new codes (e.g., no "zh-cn", "sg-en").\n- If content is code-mixed, pick the language covering the majority of meaningful tokens in CONTENT.\n- If near-tie, prefer the language used by the majority of complete sentences in CONTENT.\n- Normalize: treat Chinese/Mandarin as "zh"; Bahasa Melayu -> "ms"; Bahasa Indonesia -> "id".\n- Ignore when deciding: URLs, email addresses, numbers, emojis, boilerplate signatures/disclaimers, quoted previous replies, headers like "Re:"/"Fwd:".\n- Be deterministic.\n\n[OUTPUT FORMAT]\nReturn EXACTLY one single-line minified JSON object (no prose, no markdown, no code fences):\n{\n    "base_language":"<iso>"\n}\n\n[EMAIL CONTENT]\n```\nHello! I have an exclusive investment opportunity for you. We are offering 500% returns on cryptocurrency investments within 30 days. This is a limited-time offer. Please transfer your funds to our secure wallet: 1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa. Don\'t miss this chance to become wealthy!\n```\n'}], 'model': 'aisingapore/Llama-SEA-LION-v3.5-70B-R'}, 'extra_json': {'chat_template_kwargs': {'thinking_mode': 'off'}, 'cache': {'no-cache': True}}}
2025-08-17 00:57:33,500 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.sea-lion.ai/v1/chat/completions
2025-08-17 00:57:33,501 - httpcore.connection - DEBUG - close.started
2025-08-17 00:57:33,501 - httpcore.connection - DEBUG - close.complete
2025-08-17 00:57:33,502 - httpcore.connection - DEBUG - connect_tcp.started host='api.sea-lion.ai' port=443 local_address=None timeout=5.0 socket_options=None
2025-08-17 00:57:33,772 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001B2DDC4F750>
2025-08-17 00:57:33,772 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000001B2DC1D2F00> server_hostname='api.sea-lion.ai' timeout=5.0
2025-08-17 00:57:34,315 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001B2DD401BA0>
2025-08-17 00:57:34,316 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-17 00:57:34,317 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-08-17 00:57:34,317 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-17 00:57:34,317 - httpcore.http11 - DEBUG - send_request_body.complete
2025-08-17 00:57:34,317 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-17 00:57:34,936 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Sat, 16 Aug 2025 16:57:34 GMT'), (b'Content-Type', b'application/json'), (b'Content-Length', b'545'), (b'Connection', b'keep-alive'), (b'server', b'uvicorn'), (b'x-litellm-call-id', b'802193d7-7753-4873-8f5d-c459f25d686c'), (b'x-litellm-model-id', b'320c14227ccff7f17d435b101d7243e1ef040b82cc0be675ede6985d5a651827'), (b'x-litellm-model-api-base', b'http://llama-sea-lion-v3-5-70b-r/v1'), (b'x-litellm-version', b'1.56.3'), (b'x-litellm-response-cost', b'0.0018650000000000001'), (b'x-litellm-key-tpm-limit', b'None'), (b'x-litellm-key-rpm-limit', b'None'), (b'llm_provider-date', b'Sat, 16 Aug 2025 16:57:34 GMT'), (b'llm_provider-server', b'uvicorn'), (b'llm_provider-content-length', b'503'), (b'llm_provider-content-type', b'application/json'), (b'x-litellm-model-group', b'aisingapore/Llama-SEA-LION-v3.5-70B-R')])
2025-08-17 00:57:34,936 - httpx - INFO - HTTP Request: POST https://api.sea-lion.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-17 00:57:34,937 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-17 00:57:34,937 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-08-17 00:57:34,937 - httpcore.http11 - DEBUG - response_closed.started
2025-08-17 00:57:34,937 - httpcore.http11 - DEBUG - response_closed.complete
2025-08-17 00:57:34,938 - openai._base_client - DEBUG - HTTP Response: POST https://api.sea-lion.ai/v1/chat/completions "200 OK" Headers({'date': 'Sat, 16 Aug 2025 16:57:34 GMT', 'content-type': 'application/json', 'content-length': '545', 'connection': 'keep-alive', 'server': 'uvicorn', 'x-litellm-call-id': '802193d7-7753-4873-8f5d-c459f25d686c', 'x-litellm-model-id': '320c14227ccff7f17d435b101d7243e1ef040b82cc0be675ede6985d5a651827', 'x-litellm-model-api-base': 'http://llama-sea-lion-v3-5-70b-r/v1', 'x-litellm-version': '1.56.3', 'x-litellm-response-cost': '0.0018650000000000001', 'x-litellm-key-tpm-limit': 'None', 'x-litellm-key-rpm-limit': 'None', 'llm_provider-date': 'Sat, 16 Aug 2025 16:57:34 GMT', 'llm_provider-server': 'uvicorn', 'llm_provider-content-length': '503', 'llm_provider-content-type': 'application/json', 'x-litellm-model-group': 'aisingapore/Llama-SEA-LION-v3.5-70B-R'})
2025-08-17 00:57:34,938 - openai._base_client - DEBUG - request_id: None
2025-08-17 00:57:34,946 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.sea-lion.ai/v1/chat/completions
2025-08-17 00:57:34,946 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-17 00:57:34,946 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-08-17 00:57:34,946 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-17 00:57:34,947 - httpcore.http11 - DEBUG - send_request_body.complete
2025-08-17 00:57:34,947 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-17 00:57:35,596 - pymongo.topology - DEBUG - {"message": "Server heartbeat failed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 2036.9541000109166, "failure": "\"AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')\""}
2025-08-17 00:57:35,605 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "previousDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "newDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>"}
2025-08-17 00:57:36,677 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Sat, 16 Aug 2025 16:57:36 GMT'), (b'Content-Type', b'application/json'), (b'Content-Length', b'943'), (b'Connection', b'keep-alive'), (b'server', b'uvicorn'), (b'x-litellm-call-id', b'd94aa399-471b-40af-b784-39d81fe14d81'), (b'x-litellm-model-id', b'320c14227ccff7f17d435b101d7243e1ef040b82cc0be675ede6985d5a651827'), (b'x-litellm-model-api-base', b'http://llama-sea-lion-v3-5-70b-r/v1'), (b'x-litellm-version', b'1.56.3'), (b'x-litellm-response-cost', b'0.003975'), (b'x-litellm-key-tpm-limit', b'None'), (b'x-litellm-key-rpm-limit', b'None'), (b'llm_provider-date', b'Sat, 16 Aug 2025 16:57:35 GMT'), (b'llm_provider-server', b'uvicorn'), (b'llm_provider-content-length', b'901'), (b'llm_provider-content-type', b'application/json'), (b'x-litellm-model-group', b'aisingapore/Llama-SEA-LION-v3.5-70B-R')])
2025-08-17 00:57:36,678 - httpx - INFO - HTTP Request: POST https://api.sea-lion.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-17 00:57:36,678 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-17 00:57:36,679 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-08-17 00:57:36,679 - httpcore.http11 - DEBUG - response_closed.started
2025-08-17 00:57:36,680 - httpcore.http11 - DEBUG - response_closed.complete
2025-08-17 00:57:36,680 - openai._base_client - DEBUG - HTTP Response: POST https://api.sea-lion.ai/v1/chat/completions "200 OK" Headers({'date': 'Sat, 16 Aug 2025 16:57:36 GMT', 'content-type': 'application/json', 'content-length': '943', 'connection': 'keep-alive', 'server': 'uvicorn', 'x-litellm-call-id': 'd94aa399-471b-40af-b784-39d81fe14d81', 'x-litellm-model-id': '320c14227ccff7f17d435b101d7243e1ef040b82cc0be675ede6985d5a651827', 'x-litellm-model-api-base': 'http://llama-sea-lion-v3-5-70b-r/v1', 'x-litellm-version': '1.56.3', 'x-litellm-response-cost': '0.003975', 'x-litellm-key-tpm-limit': 'None', 'x-litellm-key-rpm-limit': 'None', 'llm_provider-date': 'Sat, 16 Aug 2025 16:57:35 GMT', 'llm_provider-server': 'uvicorn', 'llm_provider-content-length': '901', 'llm_provider-content-type': 'application/json', 'x-litellm-model-group': 'aisingapore/Llama-SEA-LION-v3.5-70B-R'})
2025-08-17 00:57:36,681 - openai._base_client - DEBUG - request_id: None
2025-08-17 00:57:36,685 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-fa5e3a4e-f87b-4907-899f-7b6854ce38b4', 'json_data': {'messages': [{'role': 'user', 'content': '\n[ROLE]\nYou are a precise translator for security risk assessments, mainly translating from en to ms.\n\n[GOAL]\nTranslate the three fields into TARGET_LANGUAGE, preserving the original meaning and tone.\n\n[INPUT]\nBASE_LANGUAGE: en\nTARGET_LANGUAGE: ms\nrisk_level (BASE_LANGUAGE): high\nanalysis (BASE_LANGUAGE): The email exhibits multiple scam indicators: a cryptocurrency wallet request with unrealistic returns, a generic greeting, and a newly registered domain. These are classic phishing tactics common in Southeast Asia.\nrecommended_action (BASE_LANGUAGE): Do not send funds. Verify opportunities through official channels and report to local authorities like Singapore\'s ScamShield or Indonesia\'s BEK.\n\n[GUIDELINES]\n- Translate all three fields into TARGET_LANGUAGE.\n- Keep "risk_level" as the natural, commonly-used equivalent of low/medium/high in TARGET_LANGUAGE (short, formal).\n- "analysis": clear, 1-2 sentences, formal/helpful tone.\n- "recommended_action": short imperative (e.g., 2-8 words).\n- If BASE_LANGUAGE == TARGET_LANGUAGE, return the original text unchanged.\n- No explanations, no markdown, no extra keys.\n\n[OUTPUT FORMAT]\nYou must return EXACTLY one minified JSON object with these keys and nothing else.\nNo prose, no markdown, no code fences.\nIf there are additional or missing keys, your answer is invalid.\n\nSchema (conceptual):\n{\n    "risk_level":"<low|medium|high in TARGET_LANGUAGE>",\n    "analysis":"<1-2 sentences in TARGET_LANGUAGE>",\n    "recommended_action":"<1-2 sentences in TARGET_LANGUAGE>"\n}\n\nNow produce ONLY:\n{\n"risk_level":"...",\n"analysis":"...",\n"recommended_action":"..."\n}\n'}], 'model': 'aisingapore/Llama-SEA-LION-v3.5-70B-R'}, 'extra_json': {'chat_template_kwargs': {'thinking_mode': 'off'}, 'cache': {'no-cache': True}}}
2025-08-17 00:57:36,687 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.sea-lion.ai/v1/chat/completions
2025-08-17 00:57:36,687 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-17 00:57:36,688 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-08-17 00:57:36,689 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-17 00:57:36,690 - httpcore.http11 - DEBUG - send_request_body.complete
2025-08-17 00:57:36,690 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-17 00:57:39,031 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Sat, 16 Aug 2025 16:57:38 GMT'), (b'Content-Type', b'application/json'), (b'Content-Length', b'940'), (b'Connection', b'keep-alive'), (b'server', b'uvicorn'), (b'x-litellm-call-id', b'4d1ca89b-79ad-476f-9b9f-0c1e1c6f6d7c'), (b'x-litellm-model-id', b'320c14227ccff7f17d435b101d7243e1ef040b82cc0be675ede6985d5a651827'), (b'x-litellm-model-api-base', b'http://llama-sea-lion-v3-5-70b-r/v1'), (b'x-litellm-version', b'1.56.3'), (b'x-litellm-response-cost', b'0.00347'), (b'x-litellm-key-tpm-limit', b'None'), (b'x-litellm-key-rpm-limit', b'None'), (b'llm_provider-date', b'Sat, 16 Aug 2025 16:57:36 GMT'), (b'llm_provider-server', b'uvicorn'), (b'llm_provider-content-length', b'898'), (b'llm_provider-content-type', b'application/json'), (b'x-litellm-model-group', b'aisingapore/Llama-SEA-LION-v3.5-70B-R')])
2025-08-17 00:57:39,031 - httpx - INFO - HTTP Request: POST https://api.sea-lion.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-17 00:57:39,032 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-17 00:57:39,032 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-08-17 00:57:39,032 - httpcore.http11 - DEBUG - response_closed.started
2025-08-17 00:57:39,032 - httpcore.http11 - DEBUG - response_closed.complete
2025-08-17 00:57:39,033 - openai._base_client - DEBUG - HTTP Response: POST https://api.sea-lion.ai/v1/chat/completions "200 OK" Headers({'date': 'Sat, 16 Aug 2025 16:57:38 GMT', 'content-type': 'application/json', 'content-length': '940', 'connection': 'keep-alive', 'server': 'uvicorn', 'x-litellm-call-id': '4d1ca89b-79ad-476f-9b9f-0c1e1c6f6d7c', 'x-litellm-model-id': '320c14227ccff7f17d435b101d7243e1ef040b82cc0be675ede6985d5a651827', 'x-litellm-model-api-base': 'http://llama-sea-lion-v3-5-70b-r/v1', 'x-litellm-version': '1.56.3', 'x-litellm-response-cost': '0.00347', 'x-litellm-key-tpm-limit': 'None', 'x-litellm-key-rpm-limit': 'None', 'llm_provider-date': 'Sat, 16 Aug 2025 16:57:36 GMT', 'llm_provider-server': 'uvicorn', 'llm_provider-content-length': '898', 'llm_provider-content-type': 'application/json', 'x-litellm-model-group': 'aisingapore/Llama-SEA-LION-v3.5-70B-R'})
2025-08-17 00:57:39,033 - openai._base_client - DEBUG - request_id: None
2025-08-17 00:57:39,034 - pymongo.serverSelection - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "clientId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}}
2025-08-17 00:57:39,034 - pymongo.serverSelection - DEBUG - {"message": "Waiting for suitable server to become available", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "clientId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "remainingTimeMS": 4999}
2025-08-17 00:57:41,152 - pymongo.topology - DEBUG - {"message": "Server heartbeat failed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 2043.8864000025205, "failure": "\"AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')\""}
2025-08-17 00:57:41,152 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "previousDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "newDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>"}
2025-08-17 00:57:43,693 - pymongo.topology - DEBUG - {"message": "Server heartbeat failed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 2039.9413999984972, "failure": "\"AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')\""}
2025-08-17 00:57:43,694 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "previousDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "newDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>"}
2025-08-17 00:57:44,204 - pymongo.serverSelection - DEBUG - {"message": "Server selection failed", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "clientId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "failure": "\"localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)\""}
2025-08-17 00:57:44,205 - pymongo.serverSelection - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x000001B2DB94F240>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "clientId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}}
2025-08-17 00:57:44,205 - pymongo.serverSelection - DEBUG - {"message": "Waiting for suitable server to become available", "selector": "<function writable_server_selector at 0x000001B2DB94F240>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "clientId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "remainingTimeMS": 4999}
2025-08-17 00:57:46,239 - pymongo.topology - DEBUG - {"message": "Server heartbeat failed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 2043.159699998796, "failure": "\"AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')\""}
2025-08-17 00:57:46,239 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "previousDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "newDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>"}
2025-08-17 00:57:48,772 - pymongo.topology - DEBUG - {"message": "Server heartbeat failed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 2032.2816999978386, "failure": "\"AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')\""}
2025-08-17 00:57:48,772 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "previousDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "newDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>"}
2025-08-17 00:57:49,286 - pymongo.serverSelection - DEBUG - {"message": "Server selection failed", "selector": "<function writable_server_selector at 0x000001B2DB94F240>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "clientId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "failure": "\"localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)\""}
2025-08-17 00:57:49,287 - middleware.auth_middleware - INFO - Response: 200 - 15.791s
2025-08-17 00:57:51,321 - pymongo.topology - DEBUG - {"message": "Server heartbeat failed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 2048.001299990574, "failure": "\"AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')\""}
2025-08-17 00:57:51,321 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "previousDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "newDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>"}
2025-08-17 00:57:56,627 - middleware.auth_middleware - INFO - Request: POST /email/analyze - 2025-08-17 00:57:56.627639
2025-08-17 00:57:56,630 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-65f70c59-c3e9-4a67-a633-8e955decc292', 'json_data': {'messages': [{'role': 'user', 'content': '\n[ROLE]\nYou are a precise language identification module for email data in Southeast Asia.\n\n[GOAL]\nReturn ONLY the dominant BASE language of the EMAIL CONTENT as an ISO-639-1 code in lowercase.\n\n[AVAILABLE LANGUAGES]\n```\nen, zh, ms, th, vi\n```\n\n[RULES]\n- Choose from ALLOWED LANGUAGES only. Do not invent new codes (e.g., no "zh-cn", "sg-en").\n- If content is code-mixed, pick the language covering the majority of meaningful tokens in CONTENT.\n- If near-tie, prefer the language used by the majority of complete sentences in CONTENT.\n- Normalize: treat Chinese/Mandarin as "zh"; Bahasa Melayu -> "ms"; Bahasa Indonesia -> "id".\n- Ignore when deciding: URLs, email addresses, numbers, emojis, boilerplate signatures/disclaimers, quoted previous replies, headers like "Re:"/"Fwd:".\n- Be deterministic.\n\n[OUTPUT FORMAT]\nReturn EXACTLY one single-line minified JSON object (no prose, no markdown, no code fences):\n{\n    "base_language":"<iso>"\n}\n\n[EMAIL CONTENT]\n```\nHi team, just a reminder that we have our weekly meeting tomorrow at 2 PM. Please prepare your updates and join the Zoom call. The agenda includes project updates and Q&A session. Looking forward to seeing everyone there!\n```\n'}], 'model': 'aisingapore/Llama-SEA-LION-v3.5-70B-R'}, 'extra_json': {'chat_template_kwargs': {'thinking_mode': 'off'}, 'cache': {'no-cache': True}}}
2025-08-17 00:57:56,631 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.sea-lion.ai/v1/chat/completions
2025-08-17 00:57:56,631 - httpcore.connection - DEBUG - close.started
2025-08-17 00:57:56,631 - httpcore.connection - DEBUG - close.complete
2025-08-17 00:57:56,632 - httpcore.connection - DEBUG - connect_tcp.started host='api.sea-lion.ai' port=443 local_address=None timeout=5.0 socket_options=None
2025-08-17 00:57:56,911 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001B2DD4028B0>
2025-08-17 00:57:56,913 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000001B2DC1D2F00> server_hostname='api.sea-lion.ai' timeout=5.0
2025-08-17 00:57:57,431 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001B2DD593890>
2025-08-17 00:57:57,432 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-17 00:57:57,432 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-08-17 00:57:57,433 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-17 00:57:57,434 - httpcore.http11 - DEBUG - send_request_body.complete
2025-08-17 00:57:57,434 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-17 00:57:58,040 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Sat, 16 Aug 2025 16:57:57 GMT'), (b'Content-Type', b'application/json'), (b'Content-Length', b'545'), (b'Connection', b'keep-alive'), (b'server', b'uvicorn'), (b'x-litellm-call-id', b'919e17ef-f003-4c44-bcce-1d7643cc879f'), (b'x-litellm-model-id', b'320c14227ccff7f17d435b101d7243e1ef040b82cc0be675ede6985d5a651827'), (b'x-litellm-model-api-base', b'http://llama-sea-lion-v3-5-70b-r/v1'), (b'x-litellm-version', b'1.56.3'), (b'x-litellm-response-cost', b'0.0017000000000000001'), (b'x-litellm-key-tpm-limit', b'None'), (b'x-litellm-key-rpm-limit', b'None'), (b'llm_provider-date', b'Sat, 16 Aug 2025 16:57:57 GMT'), (b'llm_provider-server', b'uvicorn'), (b'llm_provider-content-length', b'503'), (b'llm_provider-content-type', b'application/json'), (b'x-litellm-model-group', b'aisingapore/Llama-SEA-LION-v3.5-70B-R')])
2025-08-17 00:57:58,041 - httpx - INFO - HTTP Request: POST https://api.sea-lion.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-17 00:57:58,042 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-17 00:57:58,043 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-08-17 00:57:58,044 - httpcore.http11 - DEBUG - response_closed.started
2025-08-17 00:57:58,045 - httpcore.http11 - DEBUG - response_closed.complete
2025-08-17 00:57:58,046 - openai._base_client - DEBUG - HTTP Response: POST https://api.sea-lion.ai/v1/chat/completions "200 OK" Headers({'date': 'Sat, 16 Aug 2025 16:57:57 GMT', 'content-type': 'application/json', 'content-length': '545', 'connection': 'keep-alive', 'server': 'uvicorn', 'x-litellm-call-id': '919e17ef-f003-4c44-bcce-1d7643cc879f', 'x-litellm-model-id': '320c14227ccff7f17d435b101d7243e1ef040b82cc0be675ede6985d5a651827', 'x-litellm-model-api-base': 'http://llama-sea-lion-v3-5-70b-r/v1', 'x-litellm-version': '1.56.3', 'x-litellm-response-cost': '0.0017000000000000001', 'x-litellm-key-tpm-limit': 'None', 'x-litellm-key-rpm-limit': 'None', 'llm_provider-date': 'Sat, 16 Aug 2025 16:57:57 GMT', 'llm_provider-server': 'uvicorn', 'llm_provider-content-length': '503', 'llm_provider-content-type': 'application/json', 'x-litellm-model-group': 'aisingapore/Llama-SEA-LION-v3.5-70B-R'})
2025-08-17 00:57:58,047 - openai._base_client - DEBUG - request_id: None
2025-08-17 00:57:58,064 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.sea-lion.ai/v1/chat/completions
2025-08-17 00:57:58,065 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-17 00:57:58,065 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-08-17 00:57:58,066 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-17 00:57:58,066 - httpcore.http11 - DEBUG - send_request_body.complete
2025-08-17 00:57:58,066 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-17 00:57:59,496 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Sat, 16 Aug 2025 16:57:59 GMT'), (b'Content-Type', b'application/json'), (b'Content-Length', b'831'), (b'Connection', b'keep-alive'), (b'server', b'uvicorn'), (b'x-litellm-call-id', b'4e277422-d868-405e-804b-a40d7afb5991'), (b'x-litellm-model-id', b'320c14227ccff7f17d435b101d7243e1ef040b82cc0be675ede6985d5a651827'), (b'x-litellm-model-api-base', b'http://llama-sea-lion-v3-5-70b-r/v1'), (b'x-litellm-version', b'1.56.3'), (b'x-litellm-response-cost', b'0.0034600000000000004'), (b'x-litellm-key-tpm-limit', b'None'), (b'x-litellm-key-rpm-limit', b'None'), (b'llm_provider-date', b'Sat, 16 Aug 2025 16:57:58 GMT'), (b'llm_provider-server', b'uvicorn'), (b'llm_provider-content-length', b'789'), (b'llm_provider-content-type', b'application/json'), (b'x-litellm-model-group', b'aisingapore/Llama-SEA-LION-v3.5-70B-R')])
2025-08-17 00:57:59,499 - httpx - INFO - HTTP Request: POST https://api.sea-lion.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-17 00:57:59,501 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-17 00:57:59,506 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-08-17 00:57:59,507 - httpcore.http11 - DEBUG - response_closed.started
2025-08-17 00:57:59,509 - httpcore.http11 - DEBUG - response_closed.complete
2025-08-17 00:57:59,510 - openai._base_client - DEBUG - HTTP Response: POST https://api.sea-lion.ai/v1/chat/completions "200 OK" Headers({'date': 'Sat, 16 Aug 2025 16:57:59 GMT', 'content-type': 'application/json', 'content-length': '831', 'connection': 'keep-alive', 'server': 'uvicorn', 'x-litellm-call-id': '4e277422-d868-405e-804b-a40d7afb5991', 'x-litellm-model-id': '320c14227ccff7f17d435b101d7243e1ef040b82cc0be675ede6985d5a651827', 'x-litellm-model-api-base': 'http://llama-sea-lion-v3-5-70b-r/v1', 'x-litellm-version': '1.56.3', 'x-litellm-response-cost': '0.0034600000000000004', 'x-litellm-key-tpm-limit': 'None', 'x-litellm-key-rpm-limit': 'None', 'llm_provider-date': 'Sat, 16 Aug 2025 16:57:58 GMT', 'llm_provider-server': 'uvicorn', 'llm_provider-content-length': '789', 'llm_provider-content-type': 'application/json', 'x-litellm-model-group': 'aisingapore/Llama-SEA-LION-v3.5-70B-R'})
2025-08-17 00:57:59,517 - openai._base_client - DEBUG - request_id: None
2025-08-17 00:57:59,520 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-a9fee089-159a-4f0a-a356-f3920d2183a3', 'json_data': {'messages': [{'role': 'user', 'content': '\n[ROLE]\nYou are a precise translator for security risk assessments, mainly translating from en to zh.\n\n[GOAL]\nTranslate the three fields into TARGET_LANGUAGE, preserving the original meaning and tone.\n\n[INPUT]\nBASE_LANGUAGE: en\nTARGET_LANGUAGE: zh\nrisk_level (BASE_LANGUAGE): low\nanalysis (BASE_LANGUAGE): The email contains no red flags: no urgent requests, financial demands, suspicious links, or sender inconsistencies. It is a routine meeting reminder from a legitimate company domain.\nrecommended_action (BASE_LANGUAGE): Proceed normally; verify sender details if uncertain.\n\n[GUIDELINES]\n- Translate all three fields into TARGET_LANGUAGE.\n- Keep "risk_level" as the natural, commonly-used equivalent of low/medium/high in TARGET_LANGUAGE (short, formal).\n- "analysis": clear, 1-2 sentences, formal/helpful tone.\n- "recommended_action": short imperative (e.g., 2-8 words).\n- If BASE_LANGUAGE == TARGET_LANGUAGE, return the original text unchanged.\n- No explanations, no markdown, no extra keys.\n\n[OUTPUT FORMAT]\nYou must return EXACTLY one minified JSON object with these keys and nothing else.\nNo prose, no markdown, no code fences.\nIf there are additional or missing keys, your answer is invalid.\n\nSchema (conceptual):\n{\n    "risk_level":"<low|medium|high in TARGET_LANGUAGE>",\n    "analysis":"<1-2 sentences in TARGET_LANGUAGE>",\n    "recommended_action":"<1-2 sentences in TARGET_LANGUAGE>"\n}\n\nNow produce ONLY:\n{\n"risk_level":"...",\n"analysis":"...",\n"recommended_action":"..."\n}\n'}], 'model': 'aisingapore/Llama-SEA-LION-v3.5-70B-R'}, 'extra_json': {'chat_template_kwargs': {'thinking_mode': 'off'}, 'cache': {'no-cache': True}}}
2025-08-17 00:57:59,522 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.sea-lion.ai/v1/chat/completions
2025-08-17 00:57:59,522 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-17 00:57:59,523 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-08-17 00:57:59,523 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-17 00:57:59,524 - httpcore.http11 - DEBUG - send_request_body.complete
2025-08-17 00:57:59,524 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-17 00:58:02,161 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Sat, 16 Aug 2025 16:58:02 GMT'), (b'Content-Type', b'application/json'), (b'Content-Length', b'775'), (b'Connection', b'keep-alive'), (b'server', b'uvicorn'), (b'x-litellm-call-id', b'b5dff31f-e36a-402e-a235-2428a1701757'), (b'x-litellm-model-id', b'320c14227ccff7f17d435b101d7243e1ef040b82cc0be675ede6985d5a651827'), (b'x-litellm-model-api-base', b'http://llama-sea-lion-v3-5-70b-r/v1'), (b'x-litellm-version', b'1.56.3'), (b'x-litellm-response-cost', b'0.0027400000000000002'), (b'x-litellm-key-tpm-limit', b'None'), (b'x-litellm-key-rpm-limit', b'None'), (b'llm_provider-date', b'Sat, 16 Aug 2025 16:58:00 GMT'), (b'llm_provider-server', b'uvicorn'), (b'llm_provider-content-length', b'733'), (b'llm_provider-content-type', b'application/json'), (b'x-litellm-model-group', b'aisingapore/Llama-SEA-LION-v3.5-70B-R')])
2025-08-17 00:58:02,162 - httpx - INFO - HTTP Request: POST https://api.sea-lion.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-17 00:58:02,162 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-17 00:58:02,162 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-08-17 00:58:02,163 - httpcore.http11 - DEBUG - response_closed.started
2025-08-17 00:58:02,163 - httpcore.http11 - DEBUG - response_closed.complete
2025-08-17 00:58:02,163 - openai._base_client - DEBUG - HTTP Response: POST https://api.sea-lion.ai/v1/chat/completions "200 OK" Headers({'date': 'Sat, 16 Aug 2025 16:58:02 GMT', 'content-type': 'application/json', 'content-length': '775', 'connection': 'keep-alive', 'server': 'uvicorn', 'x-litellm-call-id': 'b5dff31f-e36a-402e-a235-2428a1701757', 'x-litellm-model-id': '320c14227ccff7f17d435b101d7243e1ef040b82cc0be675ede6985d5a651827', 'x-litellm-model-api-base': 'http://llama-sea-lion-v3-5-70b-r/v1', 'x-litellm-version': '1.56.3', 'x-litellm-response-cost': '0.0027400000000000002', 'x-litellm-key-tpm-limit': 'None', 'x-litellm-key-rpm-limit': 'None', 'llm_provider-date': 'Sat, 16 Aug 2025 16:58:00 GMT', 'llm_provider-server': 'uvicorn', 'llm_provider-content-length': '733', 'llm_provider-content-type': 'application/json', 'x-litellm-model-group': 'aisingapore/Llama-SEA-LION-v3.5-70B-R'})
2025-08-17 00:58:02,163 - openai._base_client - DEBUG - request_id: None
2025-08-17 00:58:02,164 - pymongo.serverSelection - DEBUG - {"message": "Server selection started", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "clientId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}}
2025-08-17 00:58:02,165 - pymongo.serverSelection - DEBUG - {"message": "Waiting for suitable server to become available", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "clientId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "remainingTimeMS": 4999}
2025-08-17 00:58:03,404 - pymongo.topology - DEBUG - {"message": "Server heartbeat failed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 2070.32969998545, "failure": "\"AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')\""}
2025-08-17 00:58:03,405 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "previousDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "newDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>"}
2025-08-17 00:58:05,958 - pymongo.topology - DEBUG - {"message": "Server heartbeat failed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 2052.194700023392, "failure": "\"AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')\""}
2025-08-17 00:58:05,959 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "previousDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "newDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>"}
2025-08-17 00:58:07,487 - pymongo.serverSelection - DEBUG - {"message": "Server selection failed", "selector": "Primary()", "operation": "find", "topologyDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "clientId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "failure": "\"localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)\""}
2025-08-17 00:58:07,488 - pymongo.serverSelection - DEBUG - {"message": "Server selection started", "selector": "<function writable_server_selector at 0x000001B2DB94F240>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "clientId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}}
2025-08-17 00:58:07,489 - pymongo.serverSelection - DEBUG - {"message": "Waiting for suitable server to become available", "selector": "<function writable_server_selector at 0x000001B2DB94F240>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "clientId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "remainingTimeMS": 4999}
2025-08-17 00:58:08,495 - pymongo.topology - DEBUG - {"message": "Server heartbeat failed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 2034.9236000038218, "failure": "\"AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')\""}
2025-08-17 00:58:08,496 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "previousDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "newDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>"}
2025-08-17 00:58:11,009 - pymongo.topology - DEBUG - {"message": "Server heartbeat failed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 2013.1359999941196, "failure": "\"AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')\""}
2025-08-17 00:58:11,010 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "previousDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "newDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>"}
2025-08-17 00:58:12,544 - pymongo.serverSelection - DEBUG - {"message": "Server selection failed", "selector": "<function writable_server_selector at 0x000001B2DB94F240>", "operation": "insert", "topologyDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "clientId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "failure": "\"localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)\""}
2025-08-17 00:58:12,545 - middleware.auth_middleware - INFO - Response: 200 - 15.918s
2025-08-17 00:58:12,547 - middleware.auth_middleware - INFO - Request: POST /website/analyze - 2025-08-17 00:58:12.547398
2025-08-17 00:58:12,550 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-7ca51a61-0336-49ec-beb7-9c558d51cb29', 'json_data': {'messages': [{'role': 'user', 'content': '\n[ROLE]\nYou are a precise language identification module for website content in Southeast Asia.\n\n[GOAL]\nReturn ONLY the dominant BASE language of the WEBSITE CONTENT as an ISO-639-1 code in lowercase.\n\n[AVAILABLE LANGUAGES]\n```\nen, zh, ms, th, vi\n```\n\n[RULES]\n- Choose from ALLOWED LANGUAGES only. Do not invent new codes (e.g., no "zh-cn", "sg-en").\n- If content is code-mixed, pick the language covering the majority of meaningful tokens in CONTENT.\n- If near-tie, prefer the language used by the majority of complete sentences in CONTENT.\n- Normalize: treat "Chinese/Mandarin" as "zh"; "Bahasa Melayu" -> "ms"; "Bahasa Indonesia" -> "id".\n- Ignore when deciding: URLs, HTML tags, numbers, technical terms, boilerplate text.\n- Be deterministic.\n\n[OUTPUT FORMAT]\nReturn EXACTLY one single-line minified JSON object (no prose, no markdown, no code fences):\n{\n    "base_language":"<iso>"\n}\n\n[WEBSITE CONTENT]\n```\nPayPal - Sign In to Your Account Welcome to PayPal. Please sign in to your account to continue. Enter your email address and password below. For your security, we may ask you to verify your identity. If you don\'t have an account, you can create one for free. Contact us via WhatsApp: +1-800-123-4567 for immediate assistance.\n```\n'}], 'model': 'aisingapore/Llama-SEA-LION-v3.5-70B-R'}, 'extra_json': {'chat_template_kwargs': {'thinking_mode': 'off'}, 'cache': {'no-cache': True}}}
2025-08-17 00:58:12,551 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.sea-lion.ai/v1/chat/completions
2025-08-17 00:58:12,551 - httpcore.connection - DEBUG - close.started
2025-08-17 00:58:12,552 - httpcore.connection - DEBUG - close.complete
2025-08-17 00:58:12,552 - httpcore.connection - DEBUG - connect_tcp.started host='api.sea-lion.ai' port=443 local_address=None timeout=5.0 socket_options=None
2025-08-17 00:58:12,810 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001B2DD6548D0>
2025-08-17 00:58:12,811 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x000001B2DC1D2F00> server_hostname='api.sea-lion.ai' timeout=5.0
2025-08-17 00:58:13,279 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.sync.SyncStream object at 0x000001B2DD655D00>
2025-08-17 00:58:13,280 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-17 00:58:13,280 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-08-17 00:58:13,281 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-17 00:58:13,281 - httpcore.http11 - DEBUG - send_request_body.complete
2025-08-17 00:58:13,282 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-17 00:58:13,545 - pymongo.topology - DEBUG - {"message": "Server heartbeat failed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 2033.70209998684, "failure": "\"AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')\""}
2025-08-17 00:58:13,546 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "previousDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "newDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>"}
2025-08-17 00:58:13,883 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Sat, 16 Aug 2025 16:58:13 GMT'), (b'Content-Type', b'application/json'), (b'Content-Length', b'545'), (b'Connection', b'keep-alive'), (b'server', b'uvicorn'), (b'x-litellm-call-id', b'aaa882d6-e2e4-43fd-ba22-8a4ebfdb99d0'), (b'x-litellm-model-id', b'320c14227ccff7f17d435b101d7243e1ef040b82cc0be675ede6985d5a651827'), (b'x-litellm-model-api-base', b'http://llama-sea-lion-v3-5-70b-r/v1'), (b'x-litellm-version', b'1.56.3'), (b'x-litellm-response-cost', b'0.0017800000000000001'), (b'x-litellm-key-tpm-limit', b'None'), (b'x-litellm-key-rpm-limit', b'None'), (b'llm_provider-date', b'Sat, 16 Aug 2025 16:58:13 GMT'), (b'llm_provider-server', b'uvicorn'), (b'llm_provider-content-length', b'503'), (b'llm_provider-content-type', b'application/json'), (b'x-litellm-model-group', b'aisingapore/Llama-SEA-LION-v3.5-70B-R')])
2025-08-17 00:58:13,884 - httpx - INFO - HTTP Request: POST https://api.sea-lion.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-17 00:58:13,884 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-17 00:58:13,885 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-08-17 00:58:13,885 - httpcore.http11 - DEBUG - response_closed.started
2025-08-17 00:58:13,885 - httpcore.http11 - DEBUG - response_closed.complete
2025-08-17 00:58:13,885 - openai._base_client - DEBUG - HTTP Response: POST https://api.sea-lion.ai/v1/chat/completions "200 OK" Headers({'date': 'Sat, 16 Aug 2025 16:58:13 GMT', 'content-type': 'application/json', 'content-length': '545', 'connection': 'keep-alive', 'server': 'uvicorn', 'x-litellm-call-id': 'aaa882d6-e2e4-43fd-ba22-8a4ebfdb99d0', 'x-litellm-model-id': '320c14227ccff7f17d435b101d7243e1ef040b82cc0be675ede6985d5a651827', 'x-litellm-model-api-base': 'http://llama-sea-lion-v3-5-70b-r/v1', 'x-litellm-version': '1.56.3', 'x-litellm-response-cost': '0.0017800000000000001', 'x-litellm-key-tpm-limit': 'None', 'x-litellm-key-rpm-limit': 'None', 'llm_provider-date': 'Sat, 16 Aug 2025 16:58:13 GMT', 'llm_provider-server': 'uvicorn', 'llm_provider-content-length': '503', 'llm_provider-content-type': 'application/json', 'x-litellm-model-group': 'aisingapore/Llama-SEA-LION-v3.5-70B-R'})
2025-08-17 00:58:13,886 - openai._base_client - DEBUG - request_id: None
2025-08-17 00:58:13,891 - middleware.auth_middleware - ERROR - Unhandled error in POST /website/analyze: 'list' object has no attribute 'items'
2025-08-17 00:58:13,892 - middleware.auth_middleware - ERROR - Error type: AttributeError
2025-08-17 00:58:13,894 - middleware.auth_middleware - ERROR - Traceback: Traceback (most recent call last):
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 365, in __call__
    logger.error(
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 304, in __call__
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\apis\website.py", line 88, in analyze_website
    signals = extract_website_signals(
        url=url,
    ...<3 lines>...
        metadata=metadata
    )
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\utils\websiteUtils.py", line 287, in extract_website_signals
    for category, keyword_list in WEBSITE_KEYWORDS.items():
                                  ^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'list' object has no attribute 'items'

2025-08-17 00:58:13,894 - middleware.auth_middleware - INFO - Response: 500 - 1.347s
2025-08-17 00:58:13,896 - middleware.auth_middleware - INFO - Request: POST /website/analyze - 2025-08-17 00:58:13.896179
2025-08-17 00:58:13,899 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-e11d2c33-5c46-4360-abb8-e1683fe7945c', 'json_data': {'messages': [{'role': 'user', 'content': '\n[ROLE]\nYou are a precise language identification module for website content in Southeast Asia.\n\n[GOAL]\nReturn ONLY the dominant BASE language of the WEBSITE CONTENT as an ISO-639-1 code in lowercase.\n\n[AVAILABLE LANGUAGES]\n```\nen, zh, ms, th, vi\n```\n\n[RULES]\n- Choose from ALLOWED LANGUAGES only. Do not invent new codes (e.g., no "zh-cn", "sg-en").\n- If content is code-mixed, pick the language covering the majority of meaningful tokens in CONTENT.\n- If near-tie, prefer the language used by the majority of complete sentences in CONTENT.\n- Normalize: treat "Chinese/Mandarin" as "zh"; "Bahasa Melayu" -> "ms"; "Bahasa Indonesia" -> "id".\n- Ignore when deciding: URLs, HTML tags, numbers, technical terms, boilerplate text.\n- Be deterministic.\n\n[OUTPUT FORMAT]\nReturn EXACTLY one single-line minified JSON object (no prose, no markdown, no code fences):\n{\n    "base_language":"<iso>"\n}\n\n[WEBSITE CONTENT]\n```\nIRS Tax Refund - Verify Your Identity Internal Revenue Service - Tax Refund Verification. Your tax refund of $2,847.50 is ready for processing. To receive your refund, please verify your identity by entering your Social Security Number, date of birth, and bank account information. This verification is required by law. Failure to complete verification within 24 hours will result in refund cancellation.\n```\n'}], 'model': 'aisingapore/Llama-SEA-LION-v3.5-70B-R'}, 'extra_json': {'chat_template_kwargs': {'thinking_mode': 'off'}, 'cache': {'no-cache': True}}}
2025-08-17 00:58:13,900 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.sea-lion.ai/v1/chat/completions
2025-08-17 00:58:13,900 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-17 00:58:13,902 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-08-17 00:58:13,902 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-17 00:58:13,903 - httpcore.http11 - DEBUG - send_request_body.complete
2025-08-17 00:58:13,903 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-17 00:58:14,494 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Sat, 16 Aug 2025 16:58:14 GMT'), (b'Content-Type', b'application/json'), (b'Content-Length', b'545'), (b'Connection', b'keep-alive'), (b'server', b'uvicorn'), (b'x-litellm-call-id', b'e1028564-17d4-4baf-b01e-58dd169df356'), (b'x-litellm-model-id', b'320c14227ccff7f17d435b101d7243e1ef040b82cc0be675ede6985d5a651827'), (b'x-litellm-model-api-base', b'http://llama-sea-lion-v3-5-70b-r/v1'), (b'x-litellm-version', b'1.56.3'), (b'x-litellm-response-cost', b'0.0017950000000000002'), (b'x-litellm-key-tpm-limit', b'None'), (b'x-litellm-key-rpm-limit', b'None'), (b'llm_provider-date', b'Sat, 16 Aug 2025 16:58:13 GMT'), (b'llm_provider-server', b'uvicorn'), (b'llm_provider-content-length', b'503'), (b'llm_provider-content-type', b'application/json'), (b'x-litellm-model-group', b'aisingapore/Llama-SEA-LION-v3.5-70B-R')])
2025-08-17 00:58:14,495 - httpx - INFO - HTTP Request: POST https://api.sea-lion.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-17 00:58:14,495 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-17 00:58:14,496 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-08-17 00:58:14,496 - httpcore.http11 - DEBUG - response_closed.started
2025-08-17 00:58:14,496 - httpcore.http11 - DEBUG - response_closed.complete
2025-08-17 00:58:14,497 - openai._base_client - DEBUG - HTTP Response: POST https://api.sea-lion.ai/v1/chat/completions "200 OK" Headers({'date': 'Sat, 16 Aug 2025 16:58:14 GMT', 'content-type': 'application/json', 'content-length': '545', 'connection': 'keep-alive', 'server': 'uvicorn', 'x-litellm-call-id': 'e1028564-17d4-4baf-b01e-58dd169df356', 'x-litellm-model-id': '320c14227ccff7f17d435b101d7243e1ef040b82cc0be675ede6985d5a651827', 'x-litellm-model-api-base': 'http://llama-sea-lion-v3-5-70b-r/v1', 'x-litellm-version': '1.56.3', 'x-litellm-response-cost': '0.0017950000000000002', 'x-litellm-key-tpm-limit': 'None', 'x-litellm-key-rpm-limit': 'None', 'llm_provider-date': 'Sat, 16 Aug 2025 16:58:13 GMT', 'llm_provider-server': 'uvicorn', 'llm_provider-content-length': '503', 'llm_provider-content-type': 'application/json', 'x-litellm-model-group': 'aisingapore/Llama-SEA-LION-v3.5-70B-R'})
2025-08-17 00:58:14,497 - openai._base_client - DEBUG - request_id: None
2025-08-17 00:58:14,501 - middleware.auth_middleware - ERROR - Unhandled error in POST /website/analyze: 'list' object has no attribute 'items'
2025-08-17 00:58:14,501 - middleware.auth_middleware - ERROR - Error type: AttributeError
2025-08-17 00:58:14,502 - middleware.auth_middleware - ERROR - Traceback: Traceback (most recent call last):
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 365, in __call__
    logger.error(
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 304, in __call__
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\apis\website.py", line 88, in analyze_website
    signals = extract_website_signals(
        url=url,
    ...<3 lines>...
        metadata=metadata
    )
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\utils\websiteUtils.py", line 287, in extract_website_signals
    for category, keyword_list in WEBSITE_KEYWORDS.items():
                                  ^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'list' object has no attribute 'items'

2025-08-17 00:58:14,502 - middleware.auth_middleware - INFO - Response: 500 - 0.607s
2025-08-17 00:58:14,504 - middleware.auth_middleware - INFO - Request: POST /website/analyze - 2025-08-17 00:58:14.504242
2025-08-17 00:58:14,514 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.sea-lion.ai/v1/chat/completions
2025-08-17 00:58:14,514 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-17 00:58:14,515 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-08-17 00:58:14,515 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-17 00:58:14,516 - httpcore.http11 - DEBUG - send_request_body.complete
2025-08-17 00:58:14,516 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-17 00:58:15,104 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Sat, 16 Aug 2025 16:58:15 GMT'), (b'Content-Type', b'application/json'), (b'Content-Length', b'545'), (b'Connection', b'keep-alive'), (b'server', b'uvicorn'), (b'x-litellm-call-id', b'7d4ac800-ba4b-407f-bb54-a0f958f5c870'), (b'x-litellm-model-id', b'320c14227ccff7f17d435b101d7243e1ef040b82cc0be675ede6985d5a651827'), (b'x-litellm-model-api-base', b'http://llama-sea-lion-v3-5-70b-r/v1'), (b'x-litellm-version', b'1.56.3'), (b'x-litellm-response-cost', b'0.001775'), (b'x-litellm-key-tpm-limit', b'None'), (b'x-litellm-key-rpm-limit', b'None'), (b'llm_provider-date', b'Sat, 16 Aug 2025 16:58:14 GMT'), (b'llm_provider-server', b'uvicorn'), (b'llm_provider-content-length', b'503'), (b'llm_provider-content-type', b'application/json'), (b'x-litellm-model-group', b'aisingapore/Llama-SEA-LION-v3.5-70B-R')])
2025-08-17 00:58:15,105 - httpx - INFO - HTTP Request: POST https://api.sea-lion.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-17 00:58:15,105 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-17 00:58:15,105 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-08-17 00:58:15,106 - httpcore.http11 - DEBUG - response_closed.started
2025-08-17 00:58:15,106 - httpcore.http11 - DEBUG - response_closed.complete
2025-08-17 00:58:15,106 - openai._base_client - DEBUG - HTTP Response: POST https://api.sea-lion.ai/v1/chat/completions "200 OK" Headers({'date': 'Sat, 16 Aug 2025 16:58:15 GMT', 'content-type': 'application/json', 'content-length': '545', 'connection': 'keep-alive', 'server': 'uvicorn', 'x-litellm-call-id': '7d4ac800-ba4b-407f-bb54-a0f958f5c870', 'x-litellm-model-id': '320c14227ccff7f17d435b101d7243e1ef040b82cc0be675ede6985d5a651827', 'x-litellm-model-api-base': 'http://llama-sea-lion-v3-5-70b-r/v1', 'x-litellm-version': '1.56.3', 'x-litellm-response-cost': '0.001775', 'x-litellm-key-tpm-limit': 'None', 'x-litellm-key-rpm-limit': 'None', 'llm_provider-date': 'Sat, 16 Aug 2025 16:58:14 GMT', 'llm_provider-server': 'uvicorn', 'llm_provider-content-length': '503', 'llm_provider-content-type': 'application/json', 'x-litellm-model-group': 'aisingapore/Llama-SEA-LION-v3.5-70B-R'})
2025-08-17 00:58:15,107 - openai._base_client - DEBUG - request_id: None
2025-08-17 00:58:15,110 - middleware.auth_middleware - ERROR - Unhandled error in POST /website/analyze: 'list' object has no attribute 'items'
2025-08-17 00:58:15,111 - middleware.auth_middleware - ERROR - Error type: AttributeError
2025-08-17 00:58:15,111 - middleware.auth_middleware - ERROR - Traceback: Traceback (most recent call last):
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 365, in __call__
    logger.error(
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 304, in __call__
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\apis\website.py", line 88, in analyze_website
    signals = extract_website_signals(
        url=url,
    ...<3 lines>...
        metadata=metadata
    )
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\utils\websiteUtils.py", line 287, in extract_website_signals
    for category, keyword_list in WEBSITE_KEYWORDS.items():
                                  ^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'list' object has no attribute 'items'

2025-08-17 00:58:15,111 - middleware.auth_middleware - INFO - Response: 500 - 0.608s
2025-08-17 00:58:15,113 - middleware.auth_middleware - INFO - Request: POST /socialmedia/analyze - 2025-08-17 00:58:15.113056
2025-08-17 00:58:15,126 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.sea-lion.ai/v1/chat/completions
2025-08-17 00:58:15,126 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-17 00:58:15,127 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-08-17 00:58:15,128 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-17 00:58:15,128 - httpcore.http11 - DEBUG - send_request_body.complete
2025-08-17 00:58:15,129 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-17 00:58:15,723 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Sat, 16 Aug 2025 16:58:15 GMT'), (b'Content-Type', b'application/json'), (b'Content-Length', b'545'), (b'Connection', b'keep-alive'), (b'server', b'uvicorn'), (b'x-litellm-call-id', b'e7a6e7b6-c4c9-4674-ac28-9fa5fa44afa8'), (b'x-litellm-model-id', b'320c14227ccff7f17d435b101d7243e1ef040b82cc0be675ede6985d5a651827'), (b'x-litellm-model-api-base', b'http://llama-sea-lion-v3-5-70b-r/v1'), (b'x-litellm-version', b'1.56.3'), (b'x-litellm-response-cost', b'0.0018050000000000002'), (b'x-litellm-key-tpm-limit', b'None'), (b'x-litellm-key-rpm-limit', b'None'), (b'llm_provider-date', b'Sat, 16 Aug 2025 16:58:15 GMT'), (b'llm_provider-server', b'uvicorn'), (b'llm_provider-content-length', b'503'), (b'llm_provider-content-type', b'application/json'), (b'x-litellm-model-group', b'aisingapore/Llama-SEA-LION-v3.5-70B-R')])
2025-08-17 00:58:15,725 - httpx - INFO - HTTP Request: POST https://api.sea-lion.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-17 00:58:15,726 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-17 00:58:15,727 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-08-17 00:58:15,727 - httpcore.http11 - DEBUG - response_closed.started
2025-08-17 00:58:15,728 - httpcore.http11 - DEBUG - response_closed.complete
2025-08-17 00:58:15,729 - openai._base_client - DEBUG - HTTP Response: POST https://api.sea-lion.ai/v1/chat/completions "200 OK" Headers({'date': 'Sat, 16 Aug 2025 16:58:15 GMT', 'content-type': 'application/json', 'content-length': '545', 'connection': 'keep-alive', 'server': 'uvicorn', 'x-litellm-call-id': 'e7a6e7b6-c4c9-4674-ac28-9fa5fa44afa8', 'x-litellm-model-id': '320c14227ccff7f17d435b101d7243e1ef040b82cc0be675ede6985d5a651827', 'x-litellm-model-api-base': 'http://llama-sea-lion-v3-5-70b-r/v1', 'x-litellm-version': '1.56.3', 'x-litellm-response-cost': '0.0018050000000000002', 'x-litellm-key-tpm-limit': 'None', 'x-litellm-key-rpm-limit': 'None', 'llm_provider-date': 'Sat, 16 Aug 2025 16:58:15 GMT', 'llm_provider-server': 'uvicorn', 'llm_provider-content-length': '503', 'llm_provider-content-type': 'application/json', 'x-litellm-model-group': 'aisingapore/Llama-SEA-LION-v3.5-70B-R'})
2025-08-17 00:58:15,730 - openai._base_client - DEBUG - request_id: None
2025-08-17 00:58:15,738 - middleware.auth_middleware - ERROR - Unhandled error in POST /socialmedia/analyze: 'list' object has no attribute 'items'
2025-08-17 00:58:15,739 - middleware.auth_middleware - ERROR - Error type: AttributeError
2025-08-17 00:58:15,739 - middleware.auth_middleware - ERROR - Traceback: Traceback (most recent call last):
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 365, in __call__
    logger.error(
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 304, in __call__
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\apis\socialmedia.py", line 84, in analyze_social_media_post
    signals = extract_social_media_signals(
        platform=platform,
    ...<4 lines>...
        engagement_metrics=engagement_metrics
    )
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\utils\socialmediaUtils.py", line 240, in extract_social_media_signals
    for category, keyword_list in SOCIAL_MEDIA_KEYWORDS.items():
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'list' object has no attribute 'items'

2025-08-17 00:58:15,740 - middleware.auth_middleware - INFO - Response: 500 - 0.627s
2025-08-17 00:58:15,743 - middleware.auth_middleware - INFO - Request: POST /socialmedia/analyze - 2025-08-17 00:58:15.743104
2025-08-17 00:58:15,745 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-cdd93762-c371-4f84-93de-cd2cb9992129', 'json_data': {'messages': [{'role': 'user', 'content': '\n[ROLE]\nYou are a precise language identification module for social media content in Southeast Asia.\n\n[GOAL]\nReturn ONLY the dominant BASE language of the SOCIAL MEDIA CONTENT as an ISO-639-1 code in lowercase.\n\n[AVAILABLE LANGUAGES]\n```\nen, zh, ms, th, vi\n```\n\n[RULES]\n- Choose from ALLOWED LANGUAGES only. Do not invent new codes (e.g., no "zh-cn", "sg-en").\n- If content is code-mixed, pick the language covering the majority of meaningful tokens in CONTENT.\n- If near-tie, prefer the language used by the majority of complete sentences in CONTENT.\n- Normalize: treat "Chinese/Mandarin" as "zh"; "Bahasa Melayu" -> "ms"; "Bahasa Indonesia" -> "id".\n- Ignore when deciding: URLs, hashtags, mentions (@username), numbers, emojis, platform-specific formatting.\n- Be deterministic.\n\n[OUTPUT FORMAT]\nReturn EXACTLY one single-line minified JSON object (no prose, no markdown, no code fences):\n{\n    "base_language":"<iso>"\n}\n\n[SOCIAL MEDIA CONTENT]\n```\nJust had an amazing dinner at the new restaurant downtown! The food was incredible and the atmosphere was perfect. Highly recommend trying their signature dish. #foodie #dinner #restaurant #delicious #foodphotography\n```\n'}], 'model': 'aisingapore/Llama-SEA-LION-v3.5-70B-R'}, 'extra_json': {'chat_template_kwargs': {'thinking_mode': 'off'}, 'cache': {'no-cache': True}}}
2025-08-17 00:58:15,746 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.sea-lion.ai/v1/chat/completions
2025-08-17 00:58:15,747 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-17 00:58:15,748 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-08-17 00:58:15,748 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-17 00:58:15,748 - httpcore.http11 - DEBUG - send_request_body.complete
2025-08-17 00:58:15,749 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-17 00:58:16,068 - pymongo.topology - DEBUG - {"message": "Server heartbeat failed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 2021.9376999884844, "failure": "\"AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')\""}
2025-08-17 00:58:16,069 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "previousDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "newDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>"}
2025-08-17 00:58:16,271 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Sat, 16 Aug 2025 16:58:16 GMT'), (b'Content-Type', b'application/json'), (b'Content-Length', b'545'), (b'Connection', b'keep-alive'), (b'server', b'uvicorn'), (b'x-litellm-call-id', b'1cf9c9a8-a880-4079-b843-56faa30ec995'), (b'x-litellm-model-id', b'320c14227ccff7f17d435b101d7243e1ef040b82cc0be675ede6985d5a651827'), (b'x-litellm-model-api-base', b'http://llama-sea-lion-v3-5-70b-r/v1'), (b'x-litellm-version', b'1.56.3'), (b'x-litellm-response-cost', b'0.0016450000000000002'), (b'x-litellm-key-tpm-limit', b'None'), (b'x-litellm-key-rpm-limit', b'None'), (b'llm_provider-date', b'Sat, 16 Aug 2025 16:58:15 GMT'), (b'llm_provider-server', b'uvicorn'), (b'llm_provider-content-length', b'503'), (b'llm_provider-content-type', b'application/json'), (b'x-litellm-model-group', b'aisingapore/Llama-SEA-LION-v3.5-70B-R')])
2025-08-17 00:58:16,272 - httpx - INFO - HTTP Request: POST https://api.sea-lion.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-17 00:58:16,273 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-17 00:58:16,274 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-08-17 00:58:16,274 - httpcore.http11 - DEBUG - response_closed.started
2025-08-17 00:58:16,275 - httpcore.http11 - DEBUG - response_closed.complete
2025-08-17 00:58:16,276 - openai._base_client - DEBUG - HTTP Response: POST https://api.sea-lion.ai/v1/chat/completions "200 OK" Headers({'date': 'Sat, 16 Aug 2025 16:58:16 GMT', 'content-type': 'application/json', 'content-length': '545', 'connection': 'keep-alive', 'server': 'uvicorn', 'x-litellm-call-id': '1cf9c9a8-a880-4079-b843-56faa30ec995', 'x-litellm-model-id': '320c14227ccff7f17d435b101d7243e1ef040b82cc0be675ede6985d5a651827', 'x-litellm-model-api-base': 'http://llama-sea-lion-v3-5-70b-r/v1', 'x-litellm-version': '1.56.3', 'x-litellm-response-cost': '0.0016450000000000002', 'x-litellm-key-tpm-limit': 'None', 'x-litellm-key-rpm-limit': 'None', 'llm_provider-date': 'Sat, 16 Aug 2025 16:58:15 GMT', 'llm_provider-server': 'uvicorn', 'llm_provider-content-length': '503', 'llm_provider-content-type': 'application/json', 'x-litellm-model-group': 'aisingapore/Llama-SEA-LION-v3.5-70B-R'})
2025-08-17 00:58:16,277 - openai._base_client - DEBUG - request_id: None
2025-08-17 00:58:16,283 - middleware.auth_middleware - ERROR - Unhandled error in POST /socialmedia/analyze: 'list' object has no attribute 'items'
2025-08-17 00:58:16,284 - middleware.auth_middleware - ERROR - Error type: AttributeError
2025-08-17 00:58:16,284 - middleware.auth_middleware - ERROR - Traceback: Traceback (most recent call last):
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 365, in __call__
    logger.error(
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 304, in __call__
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\apis\socialmedia.py", line 84, in analyze_social_media_post
    signals = extract_social_media_signals(
        platform=platform,
    ...<4 lines>...
        engagement_metrics=engagement_metrics
    )
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\utils\socialmediaUtils.py", line 240, in extract_social_media_signals
    for category, keyword_list in SOCIAL_MEDIA_KEYWORDS.items():
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'list' object has no attribute 'items'

2025-08-17 00:58:16,285 - middleware.auth_middleware - INFO - Response: 500 - 0.542s
2025-08-17 00:58:16,286 - middleware.auth_middleware - INFO - Request: POST /socialmedia/analyze - 2025-08-17 00:58:16.286438
2025-08-17 00:58:16,287 - openai._base_client - DEBUG - Request options: {'method': 'post', 'url': '/chat/completions', 'files': None, 'idempotency_key': 'stainless-python-retry-4406254c-6053-47fd-8be7-155cf968129e', 'json_data': {'messages': [{'role': 'user', 'content': '\n[ROLE]\nYou are a precise language identification module for social media content in Southeast Asia.\n\n[GOAL]\nReturn ONLY the dominant BASE language of the SOCIAL MEDIA CONTENT as an ISO-639-1 code in lowercase.\n\n[AVAILABLE LANGUAGES]\n```\nen, zh, ms, th, vi\n```\n\n[RULES]\n- Choose from ALLOWED LANGUAGES only. Do not invent new codes (e.g., no "zh-cn", "sg-en").\n- If content is code-mixed, pick the language covering the majority of meaningful tokens in CONTENT.\n- If near-tie, prefer the language used by the majority of complete sentences in CONTENT.\n- Normalize: treat "Chinese/Mandarin" as "zh"; "Bahasa Melayu" -> "ms"; "Bahasa Indonesia" -> "id".\n- Ignore when deciding: URLs, hashtags, mentions (@username), numbers, emojis, platform-specific formatting.\n- Be deterministic.\n\n[OUTPUT FORMAT]\nReturn EXACTLY one single-line minified JSON object (no prose, no markdown, no code fences):\n{\n    "base_language":"<iso>"\n}\n\n[SOCIAL MEDIA CONTENT]\n```\nURGENT: Hiring 10 remote software developers! $150K salary + benefits. Must start immediately. Send your resume to hiring@tech-startup.xyz. No experience required, we provide training. This is a limited-time opportunity! #hiring #remote #software #developer #job\n```\n'}], 'model': 'aisingapore/Llama-SEA-LION-v3.5-70B-R'}, 'extra_json': {'chat_template_kwargs': {'thinking_mode': 'off'}, 'cache': {'no-cache': True}}}
2025-08-17 00:58:16,288 - openai._base_client - DEBUG - Sending HTTP Request: POST https://api.sea-lion.ai/v1/chat/completions
2025-08-17 00:58:16,289 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-08-17 00:58:16,289 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-08-17 00:58:16,289 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-08-17 00:58:16,290 - httpcore.http11 - DEBUG - send_request_body.complete
2025-08-17 00:58:16,290 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-08-17 00:58:16,812 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Date', b'Sat, 16 Aug 2025 16:58:16 GMT'), (b'Content-Type', b'application/json'), (b'Content-Length', b'545'), (b'Connection', b'keep-alive'), (b'server', b'uvicorn'), (b'x-litellm-call-id', b'a35cde94-d83a-442c-adfd-1a2cf41a735c'), (b'x-litellm-model-id', b'320c14227ccff7f17d435b101d7243e1ef040b82cc0be675ede6985d5a651827'), (b'x-litellm-model-api-base', b'http://llama-sea-lion-v3-5-70b-r/v1'), (b'x-litellm-version', b'1.56.3'), (b'x-litellm-response-cost', b'0.0017250000000000002'), (b'x-litellm-key-tpm-limit', b'None'), (b'x-litellm-key-rpm-limit', b'None'), (b'llm_provider-date', b'Sat, 16 Aug 2025 16:58:16 GMT'), (b'llm_provider-server', b'uvicorn'), (b'llm_provider-content-length', b'503'), (b'llm_provider-content-type', b'application/json'), (b'x-litellm-model-group', b'aisingapore/Llama-SEA-LION-v3.5-70B-R')])
2025-08-17 00:58:16,813 - httpx - INFO - HTTP Request: POST https://api.sea-lion.ai/v1/chat/completions "HTTP/1.1 200 OK"
2025-08-17 00:58:16,813 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-08-17 00:58:16,814 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-08-17 00:58:16,814 - httpcore.http11 - DEBUG - response_closed.started
2025-08-17 00:58:16,815 - httpcore.http11 - DEBUG - response_closed.complete
2025-08-17 00:58:16,815 - openai._base_client - DEBUG - HTTP Response: POST https://api.sea-lion.ai/v1/chat/completions "200 OK" Headers({'date': 'Sat, 16 Aug 2025 16:58:16 GMT', 'content-type': 'application/json', 'content-length': '545', 'connection': 'keep-alive', 'server': 'uvicorn', 'x-litellm-call-id': 'a35cde94-d83a-442c-adfd-1a2cf41a735c', 'x-litellm-model-id': '320c14227ccff7f17d435b101d7243e1ef040b82cc0be675ede6985d5a651827', 'x-litellm-model-api-base': 'http://llama-sea-lion-v3-5-70b-r/v1', 'x-litellm-version': '1.56.3', 'x-litellm-response-cost': '0.0017250000000000002', 'x-litellm-key-tpm-limit': 'None', 'x-litellm-key-rpm-limit': 'None', 'llm_provider-date': 'Sat, 16 Aug 2025 16:58:16 GMT', 'llm_provider-server': 'uvicorn', 'llm_provider-content-length': '503', 'llm_provider-content-type': 'application/json', 'x-litellm-model-group': 'aisingapore/Llama-SEA-LION-v3.5-70B-R'})
2025-08-17 00:58:16,816 - openai._base_client - DEBUG - request_id: None
2025-08-17 00:58:16,820 - middleware.auth_middleware - ERROR - Unhandled error in POST /socialmedia/analyze: 'list' object has no attribute 'items'
2025-08-17 00:58:16,821 - middleware.auth_middleware - ERROR - Error type: AttributeError
2025-08-17 00:58:16,821 - middleware.auth_middleware - ERROR - Traceback: Traceback (most recent call last):
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 365, in __call__
    logger.error(
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\middleware\auth_middleware.py", line 304, in __call__
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\middleware\exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\starlette\routing.py", line 73, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\fastapi\routing.py", line 301, in app
    raw_response = await run_endpoint_function(
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
    )
    ^
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\.venv\Lib\site-packages\fastapi\routing.py", line 212, in run_endpoint_function
    return await dependant.call(**values)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\apis\socialmedia.py", line 84, in analyze_social_media_post
    signals = extract_social_media_signals(
        platform=platform,
    ...<4 lines>...
        engagement_metrics=engagement_metrics
    )
  File "C:\Users\elzzh\GitLocal\mai-scam\mai-scam-backend\utils\socialmediaUtils.py", line 240, in extract_social_media_signals
    for category, keyword_list in SOCIAL_MEDIA_KEYWORDS.items():
                                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'list' object has no attribute 'items'

2025-08-17 00:58:16,822 - middleware.auth_middleware - INFO - Response: 500 - 0.536s
2025-08-17 00:58:28,150 - pymongo.topology - DEBUG - {"message": "Server heartbeat failed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 2071.669099997962, "failure": "\"AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')\""}
2025-08-17 00:58:28,151 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "previousDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "newDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>"}
2025-08-17 00:58:40,203 - pymongo.topology - DEBUG - {"message": "Server heartbeat failed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 2042.1516000060365, "failure": "\"AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')\""}
2025-08-17 00:58:40,205 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "previousDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "newDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>"}
2025-08-17 00:58:52,252 - pymongo.topology - DEBUG - {"message": "Server heartbeat failed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "serverHost": "localhost", "serverPort": 27017, "awaited": false, "durationMS": 2034.821599983843, "failure": "\"AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')\""}
2025-08-17 00:58:52,253 - pymongo.topology - DEBUG - {"message": "Topology description changed", "topologyId": {"$oid": "68a0b84f94ea0c7e9ed960c5"}, "previousDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>", "newDescription": "<TopologyDescription id: 68a0b84f94ea0c7e9ed960c5, topology_type: Unknown, servers: [<ServerDescription ('localhost', 27017) server_type: Unknown, rtt: None, error=AutoReconnect('localhost:27017: [WinError 10061] No connection could be made because the target machine actively refused it (configured timeouts: socketTimeoutMS: 5000.0ms, connectTimeoutMS: 5000.0ms)')>]>"}
2025-08-17 00:58:53,912 - Application Initialization - INFO - MAI Scam Detection API shutting down...
2025-08-17 00:58:53,913 - Application Initialization - INFO - Cleanup operations completed
2025-08-17 00:58:53,913 - Application Initialization - INFO - MAI Scam Detection API shutdown completed
2025-08-17 00:58:54,436 - httpcore.connection - DEBUG - close.started
2025-08-17 00:58:54,437 - httpcore.connection - DEBUG - close.complete
